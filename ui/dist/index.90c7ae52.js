let e,t,n,i,r,s,a,o;var l,h,u,c,d,f,p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},g={},m=g={};function y(){throw Error("setTimeout has not been defined")}function v(){throw Error("clearTimeout has not been defined")}function w(e){if(t3===setTimeout)return setTimeout(e,0);if((t3===y||!t3)&&setTimeout)return t3=setTimeout,setTimeout(e,0);try{return t3(e,0)}catch(t){try{return t3.call(null,e,0)}catch(t){return t3.call(this,e,0)}}}!function(){try{t3="function"==typeof setTimeout?setTimeout:y}catch(e){t3=y}try{t7="function"==typeof clearTimeout?clearTimeout:v}catch(e){t7=v}}();var b=[],E=!1,T=-1;function I(){E&&t8&&(E=!1,t8.length?b=t8.concat(b):T=-1,b.length&&_())}function _(){if(!E){var e=w(I);E=!0;for(var t=b.length;t;){for(t8=b,b=[];++T<t;)t8&&t8[T].run();T=-1,t=b.length}t8=null,E=!1,function(e){if(t7===clearTimeout)return clearTimeout(e);if((t7===v||!t7)&&clearTimeout)return t7=clearTimeout,clearTimeout(e);try{t7(e)}catch(t){try{return t7.call(null,e)}catch(t){return t7.call(this,e)}}}(e)}}function C(e,t){this.fun=e,this.array=t}function S(){}m.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];b.push(new C(e,t)),1!==b.length||E||w(_)},C.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=S,m.addListener=S,m.once=S,m.off=S,m.removeListener=S,m.removeAllListeners=S,m.emit=S,m.prependListener=S,m.prependOnceListener=S,m.listeners=function(e){return[]},m.binding=function(e){throw Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(e){throw Error("process.chdir is not supported")},m.umask=function(){return 0};const A=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},D=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=e[n++],a=e[n++],o=e[n++],l=((7&r)<<18|(63&s)<<12|(63&a)<<6|63&o)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(1023&l))}else{let s=e[n++],a=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&a)}}return t.join("")},k={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,h=r>>2,u=(3&r)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(c=64)),i.push(n[h],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(A(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):D(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length,a=s?n[e.charAt(t)]:0;++t;let o=t<e.length,l=o?n[e.charAt(t)]:64;++t;let h=t<e.length,u=h?n[e.charAt(t)]:64;if(++t,null==r||null==a||null==l||null==u)throw new N;let c=r<<2|a>>4;if(i.push(c),64!==l){let e=a<<4&240|l>>2;if(i.push(e),64!==u){let e=l<<6&192|u;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class N extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const L=function(e){let t=A(e);return k.encodeByteArray(t,!0)},x=function(e){return L(e).replace(/\./g,"")},R=function(e){try{return k.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},O=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==p)return p;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,M=()=>{if(void 0===g||void 0===g.env)return;let e=void 0;if(e)return JSON.parse(e)},P=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&R(e[1]);return t&&JSON.parse(t)},F=()=>{try{return O()||M()||P()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},V=e=>{var t,n;return null===(n=null===(t=F())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},U=e=>{let t=V(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},B=()=>{var e;return null===(e=F())||void 0===e?void 0:e.config};class j{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function $(){try{return"object"==typeof indexedDB}catch(e){return!1}}function q(){return new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}class z extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,z.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,K.prototype.create)}}class K{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?r.replace(H,(e,t)=>{let i=n[t];return null!=i?String(i):`<${t}?>`}):"Error",a=`${this.serviceName}: ${s} (${i}).`,o=new z(i,a,n);return o}}const H=/\{\$([^}]+)}/g;function G(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(Q(n)&&Q(s)){if(!G(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function Q(e){return null!==e&&"object"==typeof e}function W(e,t=1e3,n=2){let i=t*Math.pow(n,e);return Math.min(144e5,i+Math.round(.5*i*(Math.random()-.5)*2))}function X(e){return e&&e._delegate?e._delegate:e}class J{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Y="[DEFAULT]";class Z{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new j;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Y})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=Y){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Y){return this.instances.has(e)}getOptions(e=Y){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);n===r&&t.resolve(i)}return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);let s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:e===Y?void 0:e,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=Y){return this.component?this.component.multipleInstances?e:Y:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ee{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){let t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Z(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const et=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ne||(ne={}));const en={debug:ne.DEBUG,verbose:ne.VERBOSE,info:ne.INFO,warn:ne.WARN,error:ne.ERROR,silent:ne.SILENT},ei=ne.INFO,er={[ne.DEBUG]:"log",[ne.VERBOSE]:"log",[ne.INFO]:"info",[ne.WARN]:"warn",[ne.ERROR]:"error"},es=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=er[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ea{constructor(e){this.name=e,this._logLevel=ei,this._logHandler=es,this._userLogHandler=null,et.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ne))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?en[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ne.DEBUG,...e),this._logHandler(this,ne.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ne.VERBOSE,...e),this._logHandler(this,ne.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ne.INFO,...e),this._logHandler(this,ne.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ne.WARN,...e),this._logHandler(this,ne.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ne.ERROR,...e),this._logHandler(this,ne.ERROR,...e)}}const eo=(e,t)=>t.some(t=>e instanceof t),el=new WeakMap,eh=new WeakMap,eu=new WeakMap,ec=new WeakMap,ed=new WeakMap;let ef={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eh.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eu.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ep(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ep(n){var i;if(n instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(ep(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&el.set(t,e)}).catch(()=>{}),ed.set(t,e),t}(n);if(ec.has(n))return ec.get(n);let r="function"==typeof(i=n)?i!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(i)?function(...e){return i.apply(eg(this),e),ep(el.get(this))}:function(...e){return ep(i.apply(eg(this),e))}:function(e,...t){let n=i.call(eg(this),e,...t);return eu.set(n,e.sort?e.sort():[e]),ep(n)}:(i instanceof IDBTransaction&&function(e){if(eh.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});eh.set(e,t)}(i),eo(i,e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(i,ef):i;return r!==n&&(ec.set(n,r),ed.set(r,n)),r}const eg=e=>ed.get(e),em=["get","getKey","getAll","getAllKeys","count"],ey=["put","add","delete","clear"],ev=new Map;function ew(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ev.get(t))return ev.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=ey.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||em.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),a=s.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),r&&s.done]))[0]};return ev.set(t,s),s}ef={...t6=ef,get:(e,t,n)=>ew(e,t)||t6.get(e,t,n),has:(e,t)=>!!ew(e,t)||t6.has(e,t)};class eb{constructor(e){this.container=e}getPlatformInfoString(){let e=this.container.getProviders();return e.map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const eE="@firebase/app",eT="0.9.15",eI=new ea("@firebase/app"),e_="[DEFAULT]",eC={[eE]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},eS=new Map,eA=new Map;function eD(e){let t=e.name;if(eA.has(t))return eI.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eA.set(t,e),eS.values()))!function(e,t){try{e.container.addComponent(t)}catch(n){eI.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}(n,e);return!0}function ek(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const eN=new K("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class eL{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new J("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eN.create("app-deleted",{appName:this._name})}}function ex(e,t={}){let n=e;if("object"!=typeof t){let e=t;t={name:e}}let i=Object.assign({name:e_,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw eN.create("bad-app-name",{appName:String(r)});if(n||(n=B()),!n)throw eN.create("no-options");let s=eS.get(r);if(s){if(G(n,s.options)&&G(i,s.config))return s;throw eN.create("duplicate-app",{appName:r})}let a=new ee(r);for(let e of eA.values())a.addComponent(e);let o=new eL(n,i,a);return eS.set(r,o),o}function eR(e=e_){let t=eS.get(e);if(!t&&e===e_&&B())return ex();if(!t)throw eN.create("no-app",{appName:e});return t}function eO(e,t,n){var i;let r=null!==(i=eC[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);let s=r.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${r}" with version "${t}":`];s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eI.warn(e.join(" "));return}eD(new J(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const eM="firebase-heartbeat-store";let eP=null;function eF(){return eP||(eP=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let a=indexedDB.open(e,1),o=ep(a);return i&&a.addEventListener("upgradeneeded",e=>{i(ep(a.result),e.oldVersion,e.newVersion,ep(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(eM)}}).catch(e=>{throw eN.create("idb-open",{originalErrorMessage:e.message})})),eP}async function eV(e){try{let t=await eF(),n=await t.transaction(eM).objectStore(eM).get(eB(e));return n}catch(e){if(e instanceof z)eI.warn(e.message);else{let t=eN.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eI.warn(t.message)}}}async function eU(e,t){try{let n=await eF(),i=n.transaction(eM,"readwrite"),r=i.objectStore(eM);await r.put(t,eB(e)),await i.done}catch(e){if(e instanceof z)eI.warn(e.message);else{let t=eN.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eI.warn(t.message)}}}function eB(e){return`${e.name}!${e.options.appId}`}class ej{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new eq(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate(),t=e.getPlatformInfoString(),n=e$();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))?void 0:(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf(),n=Date.now();return n-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=e$(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),ez(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),ez(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=x(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function e$(){let e=new Date;return e.toISOString().substring(0,10)}class eq{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!$()&&q().then(()=>!0).catch(()=>!1)}async read(){let e=await this._canUseIndexedDBPromise;if(!e)return{heartbeats:[]};{let e=await eV(this.app);return e||{heartbeats:[]}}}async overwrite(e){var t;let n=await this._canUseIndexedDBPromise;if(n){let n=await this.read();return eU(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;let n=await this._canUseIndexedDBPromise;if(n){let n=await this.read();return eU(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ez(e){return x(JSON.stringify({version:2,heartbeats:e})).length}eD(new J("platform-logger",e=>new eb(e),"PRIVATE")),eD(new J("heartbeat",e=>new ej(e),"PRIVATE")),eO(eE,eT,""),eO(eE,eT,"esm2017"),eO("fire-js",""),eO("firebase","10.1.0","app");const eK=(e,t)=>t.some(t=>e instanceof t),eH=new WeakMap,eG=new WeakMap,eQ=new WeakMap,eW=new WeakMap,eX=new WeakMap;let eJ={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eG.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eQ.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eY(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eY(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(eY(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eH.set(t,e)}).catch(()=>{}),eX.set(t,e),t}(e);if(eW.has(e))return eW.get(e);let r="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(eZ(this),e),eY(eH.get(this))}:function(...e){return eY(t.apply(eZ(this),e))}:function(e,...n){let i=t.call(eZ(this),e,...n);return eQ.set(i,e.sort?e.sort():[e]),eY(i)}:(t instanceof IDBTransaction&&function(e){if(eG.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});eG.set(e,t)}(t),eK(t,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,eJ):t;return r!==e&&(eW.set(e,r),eX.set(r,e)),r}const eZ=e=>eX.get(e),e0=["get","getKey","getAll","getAllKeys","count"],e1=["put","add","delete","clear"],e2=new Map;function e9(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(e2.get(t))return e2.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=e1.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||e0.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),a=s.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),r&&s.done]))[0]};return e2.set(t,s),s}eJ={...t5=eJ,get:(e,t,n)=>e9(e,t)||t5.get(e,t,n),has:(e,t)=>!!e9(e,t)||t5.has(e,t)};const e4="@firebase/installations",e6="0.6.4",e5=`w:${e6}`,e3="FIS_v2",e7=new K("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function e8(e){return e instanceof z&&e.code.includes("request-failed")}function te({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function tt(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function tn(e,t){let n=await t.json(),i=n.error;return e7.create("request-failed",{requestName:e,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function ti({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function tr(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function ts({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let i=te(e),r=ti(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let a={fid:n,authVersion:e3,appId:e.appId,sdkVersion:e5},o={method:"POST",headers:r,body:JSON.stringify(a)},l=await tr(()=>fetch(i,o));if(l.ok){let e=await l.json(),t={fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:tt(e.authToken)};return t}throw await tn("Create Installation",l)}function ta(e){return new Promise(t=>{setTimeout(t,e)})}const to=/^[cdef][\w-]{21}$/;function tl(e){return`${e.appName}!${e.appId}`}const th=new Map;function tu(e,t){let n=tl(e);tc(n,t),function(e,t){let n=(!td&&"BroadcastChannel"in self&&((td=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{tc(e.data.key,e.data.fid)}),td);n&&n.postMessage({key:e,fid:t}),0===th.size&&td&&(td.close(),td=null)}(n,t)}function tc(e,t){let n=th.get(e);if(n)for(let e of n)e(t)}let td=null;const tf="firebase-installations-store";let tp=null;function tg(){return tp||(tp=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let a=indexedDB.open(e,1),o=eY(a);return i&&a.addEventListener("upgradeneeded",e=>{i(eY(a.result),e.oldVersion,e.newVersion,eY(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",()=>r())}).catch(()=>{}),o}("firebase-installations-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(tf)}})),tp}async function tm(e,t){let n=tl(e),i=await tg(),r=i.transaction(tf,"readwrite"),s=r.objectStore(tf),a=await s.get(n);return await s.put(t,n),await r.done,a&&a.fid===t.fid||tu(e,t.fid),t}async function ty(e){let t=tl(e),n=await tg(),i=n.transaction(tf,"readwrite");await i.objectStore(tf).delete(t),await i.done}async function tv(e,t){let n=tl(e),i=await tg(),r=i.transaction(tf,"readwrite"),s=r.objectStore(tf),a=await s.get(n),o=t(a);return void 0===o?await s.delete(n):await s.put(o,n),await r.done,o&&(!a||a.fid!==o.fid)&&tu(e,o.fid),o}async function tw(e){let t;let n=await tv(e.appConfig,n=>{let i=function(e){let t=e||{fid:function(){try{let e=new Uint8Array(17),t=self.crypto||self.msCrypto;t.getRandomValues(e),e[0]=112+e[0]%16;let n=function(e){let t=function(e){let t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(e);return to.test(n)?n:""}catch(e){return""}}(),registrationStatus:0};return tI(t)}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){let e=Promise.reject(e7.create("app-offline"));return{installationEntry:t,registrationPromise:e}}let n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=tb(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:tE(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function tb(e,t){try{let n=await ts(e,t);return tm(e.appConfig,n)}catch(n){throw e8(n)&&409===n.customData.serverCode?await ty(e.appConfig):await tm(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function tE(e){let t=await tT(e.appConfig);for(;1===t.registrationStatus;)await ta(100),t=await tT(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:n}=await tw(e);return n||t}return t}function tT(e){return tv(e,e=>{if(!e)throw e7.create("installation-not-found");return tI(e)})}function tI(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function t_({appConfig:e,heartbeatServiceProvider:t},n){let i=function(e,{fid:t}){return`${te(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){let n=ti(e);return n.append("Authorization",`${e3} ${t}`),n}(e,n),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let a={installation:{sdkVersion:e5,appId:e.appId}},o={method:"POST",headers:r,body:JSON.stringify(a)},l=await tr(()=>fetch(i,o));if(l.ok){let e=await l.json(),t=tt(e);return t}throw await tn("Generate Auth Token",l)}async function tC(e,t=!1){let n;let i=await tv(e.appConfig,i=>{var r;if(!tk(i))throw e7.create("not-registered");let s=i.authToken;if(!t&&2===(r=s).requestStatus&&!function(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(r))return i;if(1===s.requestStatus)return n=tS(e,t),i;{if(!navigator.onLine)throw e7.create("app-offline");let t=function(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=tD(e,t),t}}),r=n?await n:i.authToken;return r}async function tS(e,t){let n=await tA(e.appConfig);for(;1===n.authToken.requestStatus;)await ta(100),n=await tA(e.appConfig);let i=n.authToken;return 0===i.requestStatus?tC(e,t):i}function tA(e){return tv(e,e=>{if(!tk(e))throw e7.create("not-registered");let t=e.authToken;return 1===t.requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function tD(e,t){try{let n=await t_(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await tm(e.appConfig,i),n}catch(n){if(e8(n)&&(401===n.customData.serverCode||404===n.customData.serverCode))await ty(e.appConfig);else{let n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await tm(e.appConfig,n)}throw n}}function tk(e){return void 0!==e&&2===e.registrationStatus}async function tN(e){let{installationEntry:t,registrationPromise:n}=await tw(e);return n?n.catch(console.error):tC(e).catch(console.error),t.fid}async function tL(e,t=!1){await tx(e);let n=await tC(e,t);return n.token}async function tx(e){let{registrationPromise:t}=await tw(e);t&&await t}function tR(e){return e7.create("missing-app-config-values",{valueName:e})}const tO="installations";eD(new J(tO,e=>{let t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw tR("App Configuration");if(!e.name)throw tR("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw tR(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),i=ek(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},"PUBLIC")),eD(new J("installations-internal",e=>{let t=e.getProvider("app").getImmediate(),n=ek(t,tO).getImmediate();return{getId:()=>tN(n),getToken:e=>tL(n,e)}},"PRIVATE")),eO(e4,e6),eO(e4,e6,"esm2017");const tM="analytics",tP="https://www.googletagmanager.com/gtag/js",tF=new ea("@firebase/analytics"),tV=new K("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function tU(e){if(!e.startsWith(tP)){let t=tV.create("invalid-gtag-resource",{gtagURL:e});return tF.warn(t.message),""}return e}function tB(e){return Promise.all(e.map(e=>e.catch(e=>e)))}async function tj(e,t,n,i,r,s){let a=i[r];try{if(a)await t[a];else{let e=await tB(n),i=e.find(e=>e.measurementId===r);i&&await t[i.appId]}}catch(e){tF.error(e)}e("config",r,s)}async function t$(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);let i=await tB(n);for(let n of e){let e=i.find(e=>e.measurementId===n),r=e&&t[e.appId];if(r)s.push(r);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){tF.error(e)}}const tq=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function tz(e){var t;let{appId:n,apiKey:i}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":i})},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),a=await fetch(s,r);if(200!==a.status&&304!==a.status){let e="";try{let n=await a.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw tV.create("config-fetch-failed",{httpStatus:a.status,responseMessage:e})}return a.json()}async function tK(e,t=tq,n){let{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw tV.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw tV.create("no-api-key")}let a=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new tG;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),tH({appId:i,apiKey:r,measurementId:s},a,o,t)}async function tH(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=tq){var s;let{appId:a,measurementId:o}=e;try{await new Promise((e,n)=>{let r=Math.max(t-Date.now(),0),s=setTimeout(e,r);i.addEventListener(()=>{clearTimeout(s),n(tV.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}catch(e){if(o)return tF.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:a,measurementId:o};throw e}try{let t=await tz(e);return r.deleteThrottleMetadata(a),t}catch(h){if(!function(e){if(!(e instanceof z)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(h)){if(r.deleteThrottleMetadata(a),o)return tF.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==h?void 0:h.message}]`),{appId:a,measurementId:o};throw h}let t=503===Number(null===(s=null==h?void 0:h.customData)||void 0===s?void 0:s.httpStatus)?W(n,r.intervalMillis,30):W(n,r.intervalMillis),l={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return r.setThrottleMetadata(a,l),tF.debug(`Calling attemptFetch again in ${t} millis`),tH(e,l,i,r)}}class tG{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function tQ(e,t,n,i,r){if(r&&r.global){e("event",n,i);return}{let r=await t,s=Object.assign(Object.assign({},i),{send_to:r});e("event",n,s)}}async function tW(){if(!$())return tF.warn(tV.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await q()}catch(e){return tF.warn(tV.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}async function tX(e,t,n,i,a,o,l){var h;let u=tK(e);u.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&tF.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>tF.error(e)),t.push(u);let c=tW().then(e=>e?i.getId():void 0),[d,f]=await Promise.all([u,c]);!function(e){let t=window.document.getElementsByTagName("script");for(let n of Object.values(t))if(n.src&&n.src.includes(tP)&&n.src.includes(e))return n;return null}(o)&&function(e,t){let n;let i=(window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",{createScriptURL:tU})),n),r=document.createElement("script"),s=`${tP}?l=${e}&id=${t}`;r.src=i?null==i?void 0:i.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}(o,d.measurementId),s&&(a("consent","default",s),s=void 0),a("js",new Date);let p=null!==(h=null==l?void 0:l.config)&&void 0!==h?h:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),a("config",d.measurementId,p),r&&(a("set",r),r=void 0),d.measurementId}class tJ{constructor(e){this.app=e}_delete(){return delete tY[this.app.options.appId],Promise.resolve()}}let tY={},tZ=[];const t0={};let t1="dataLayer",t2=!1;const t9="@firebase/analytics",t4="0.10.0";eD(new J(tM,(e,{options:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return function(e,t,n){!function(){let e=[];if(function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){let t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=tV.create("invalid-analytics-context",{errorInfo:t});tF.warn(n.message)}}();let i=e.options.appId;if(!i)throw tV.create("no-app-id");if(!e.options.apiKey){if(e.options.measurementId)tF.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw tV.create("no-api-key")}if(null!=tY[i])throw tV.create("already-exists",{id:i});if(!t2){var r,s;let e,t;e=[],Array.isArray(window[t1])?e=window[t1]:window[t1]=e;let{wrappedGtag:n,gtagCore:i}=(r="gtag",t=function(...e){window[t1].push(arguments)},window[r]&&"function"==typeof window[r]&&(t=window[r]),window[r]=(s=t,async function(e,...t){try{if("event"===e){let[e,n]=t;await t$(s,tY,tZ,e,n)}else if("config"===e){let[e,n]=t;await tj(s,tY,tZ,t0,e,n)}else if("consent"===e){let[e]=t;s("consent","update",e)}else if("get"===e){let[e,n,i]=t;s("get",e,n,i)}else if("set"===e){let[e]=t;s("set",e)}else s(e,...t)}catch(e){tF.error(e)}}),{gtagCore:t,wrappedGtag:window[r]});o=n,a=i,t2=!0}tY[i]=tX(e,tZ,t0,t,a,t1,n);let l=new tJ(e);return l}(n,i,t)},"PUBLIC")),eD(new J("analytics-internal",function(e){try{let t=e.getProvider(tM).getImmediate();return{logEvent:(e,n,i)=>(function(e,t,n,i){tQ(o,tY[(e=X(e)).app.options.appId],t,n,i).catch(e=>tF.error(e))})(t,e,n,i)}}catch(e){throw tV.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),eO(t9,t4),eO(t9,t4,"esm2017");var t6,t5,t3,t7,t8,ne,nt,nn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==p?p:"undefined"!=typeof self?self:{},ni={},nr=nr||{},ns=nn||self;function na(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function no(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function nl(e,t,n){return e.call.apply(e.bind,arguments)}function nh(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function nu(e,t,n){return(nu=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?nl:nh).apply(null,arguments)}function nc(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function nd(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function nf(){this.s=this.s,this.o=this.o}nf.prototype.s=!1,nf.prototype.sa=function(){this.s||(this.s=!0,this.N())},nf.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const np=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function ng(e){let t=e.length;if(0<t){let n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function nm(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(na(n)){let t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}function ny(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}ny.prototype.h=function(){this.defaultPrevented=!0};var nv=function(){if(!ns.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{ns.addEventListener("test",()=>{},t),ns.removeEventListener("test",()=>{},t)}catch(e){}return e}();function nw(e){return/^[\s\xa0]*$/.test(e)}function nb(){var e=ns.navigator;return e&&(e=e.userAgent)?e:""}function nE(e){return -1!=nb().indexOf(e)}function nT(e){return nT[" "](e),e}nT[" "]=function(){};var nI=nE("Opera"),n_=nE("Trident")||nE("MSIE"),nC=nE("Edge"),nS=nC||n_,nA=nE("Gecko")&&!(-1!=nb().toLowerCase().indexOf("webkit")&&!nE("Edge"))&&!(nE("Trident")||nE("MSIE"))&&!nE("Edge"),nD=-1!=nb().toLowerCase().indexOf("webkit")&&!nE("Edge");function nk(){var e=ns.document;return e?e.documentMode:void 0}e:{var nN="",nL=function(){var e=nb();return nA?/rv:([^\);]+)(\)|;)/.exec(e):nC?/Edge\/([\d\.]+)/.exec(e):n_?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):nD?/WebKit\/(\S+)/.exec(e):nI?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(nL&&(nN=nL?nL[1]:""),n_){var nx=nk();if(null!=nx&&nx>parseFloat(nN)){h=String(nx);break e}}h=nN}var nR=ns.document&&n_&&(nk()||parseInt(h,10))||void 0;function nO(e,t){if(ny.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(nA){e:{try{nT(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:nM[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&nO.$.h.call(this)}}nd(nO,ny);var nM={2:"touch",3:"pen",4:"mouse"};nO.prototype.h=function(){nO.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var nP="closure_listenable_"+(1e6*Math.random()|0),nF=0;function nV(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.la=r,this.key=++nF,this.fa=this.ia=!1}function nU(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function nB(e,t,n){for(let i in e)t.call(n,e[i],i,e)}function nj(e){let t={};for(let n in e)t[n]=e[n];return t}const n$="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nq(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t])e[n]=i[n];for(let t=0;t<n$.length;t++)n=n$[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function nz(e){this.src=e,this.g={},this.h=0}function nK(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=np(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(nU(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function nH(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==i)return r}return -1}nz.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=nH(e,t,i,r);return -1<a?(t=e[a],n||(t.ia=!1)):((t=new nV(t,this.src,s,!!i,r)).ia=n,e.push(t)),t};var nG="closure_lm_"+(1e6*Math.random()|0),nQ={};function nW(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var a=no(r)?!!r.capture:!!r,o=nZ(e);if(o||(e[nG]=o=new nz(e)),(n=o.add(t,n,i,a,s)).proxy)return n;if(i=function e(t){return nY.call(e.src,e.listener,t)},n.proxy=i,i.src=e,i.listener=n,e.addEventListener)nv||(r=a),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(nJ(t.toString()),i);else if(e.addListener&&e.removeListener)e.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function nX(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[nP])nK(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(nJ(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=nZ(t))?(nK(n,e),0==n.h&&(n.src=null,t[nG]=null)):nU(e)}}}function nJ(e){return e in nQ?nQ[e]:nQ[e]="on"+e}function nY(e,t){if(e.fa)e=!0;else{t=new nO(t,this);var n=e.listener,i=e.la||e.src;e.ia&&nX(e),e=n.call(i,t)}return e}function nZ(e){return(e=e[nG])instanceof nz?e:null}var n0="__closure_events_fn_"+(1e9*Math.random()>>>0);function n1(e){return"function"==typeof e?e:(e[n0]||(e[n0]=function(t){return e.handleEvent(t)}),e[n0])}function n2(){nf.call(this),this.i=new nz(this),this.S=this,this.J=null}function n9(e,t){var n,i=e.J;if(i)for(n=[];i;i=i.J)n.push(i);if(e=e.S,i=t.type||t,"string"==typeof t)t=new ny(t,e);else if(t instanceof ny)t.target=t.target||e;else{var r=t;nq(t=new ny(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];r=n4(a,i,!0,t)&&r}if(r=n4(a=t.g=e,i,!0,t)&&r,r=n4(a,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=n4(a=t.g=n[s],i,!1,t)&&r}function n4(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.fa&&a.capture==n){var o=a.listener,l=a.la||a.src;a.ia&&nK(e.i,a),r=!1!==o.call(l,i)&&r}}return r&&!i.defaultPrevented}nd(n2,nf),n2.prototype[nP]=!0,n2.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);else(r=no(r)?!!r.capture:!!r,i=n1(i),t&&t[nP])?(t=t.i,(n=String(n).toString())in t.g&&-1<(i=nH(a=t.g[n],i,r,s))&&(nU(a[i]),Array.prototype.splice.call(a,i,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=nZ(t))&&(n=t.g[n.toString()],t=-1,n&&(t=nH(n,i,r,s)),(i=-1<t?n[t]:null)&&nX(i))}(this,e,t,n,i)},n2.prototype.N=function(){if(n2.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)nU(n[i]);delete t.g[e],t.h--}}this.J=null},n2.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},n2.prototype.P=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var n6=ns.JSON.stringify,n5=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new n3,e=>e.reset());class n3{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let n7,n8=!1,ie=new class{constructor(){this.h=this.g=null}add(e,t){let n=n5.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},it=()=>{let e=ns.Promise.resolve(void 0);n7=()=>{e.then(ii)}};var ii=()=>{for(var e;e=function(){let e=null;return ie.g&&(e=ie.g,ie.g=ie.g.next,ie.g||(ie.h=null),e.next=null),e}();){try{e.h.call(e.g)}catch(e){!function(e){ns.setTimeout(()=>{throw e},0)}(e)}n5.j(e),100>n5.h&&(n5.h++,e.next=n5.g,n5.g=e)}n8=!1};function ir(e,t){n2.call(this),this.h=e||1,this.g=t||ns,this.j=nu(this.qb,this),this.l=Date.now()}function is(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function ia(e,t,n){if("function"==typeof e)n&&(e=nu(e,n));else if(e&&"function"==typeof e.handleEvent)e=nu(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:ns.setTimeout(e,t||0)}nd(ir,n2),(nt=ir.prototype).ga=!1,nt.T=null,nt.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),n9(this,"tick"),this.ga&&(is(this),this.start()))}},nt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},nt.N=function(){ir.$.N.call(this),is(this),delete this.g};class io extends nf{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ia(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(ns.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function il(e){nf.call(this),this.h=e,this.g={}}nd(il,nf);var ih=[];function iu(e,t,n,i){Array.isArray(n)||(n&&(ih[0]=n.toString()),n=ih);for(var r=0;r<n.length;r++){var s=function e(t,n,i,r,s){if(r&&r.once)return function e(t,n,i,r,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);return null}return i=n1(i),t&&t[nP]?t.P(n,i,no(r)?!!r.capture:!!r,s):nW(t,n,i,!0,r,s)}(t,n,i,r,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);return null}return i=n1(i),t&&t[nP]?t.O(n,i,no(r)?!!r.capture:!!r,s):nW(t,n,i,!1,r,s)}(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ic(e){nB(e.g,function(e,t){this.g.hasOwnProperty(t)&&nX(e)},e),e.g={}}function id(){this.g=!0}function ip(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<r.length;a++)r[a]=""}}}}return n6(n)}catch(e){return t}}(e,n)+(i?" "+i:"")})}il.prototype.N=function(){il.$.N.call(this),ic(this)},il.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},id.prototype.Ea=function(){this.g=!1},id.prototype.info=function(){};var ig={},im=null;function iy(){return im=im||new n2}function iv(e){ny.call(this,ig.Ta,e)}function iw(e){let t=iy();n9(t,new iv(t))}function ib(e,t){ny.call(this,ig.STAT_EVENT,e),this.stat=t}function iE(e){let t=iy();n9(t,new ib(t,e))}function iT(e,t){ny.call(this,ig.Ua,e),this.size=t}function iI(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return ns.setTimeout(function(){e()},t)}ig.Ta="serverreachability",nd(iv,ny),ig.STAT_EVENT="statevent",nd(ib,ny),ig.Ua="timingevent",nd(iT,ny);var i_={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},iC={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function iS(){}function iA(e){return e.h||(e.h=e.i())}function iD(){}iS.prototype.h=null;var ik={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function iN(){ny.call(this,"d")}function iL(){ny.call(this,"c")}function ix(){}function iR(e,t,n,i){this.l=e,this.j=t,this.m=n,this.W=i||1,this.U=new il(this),this.P=iM,e=nS?125:void 0,this.V=new ir(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new iO}function iO(){this.i=null,this.g="",this.h=!1}nd(iN,ny),nd(iL,ny),nd(ix,iS),ix.prototype.g=function(){return new XMLHttpRequest},ix.prototype.i=function(){return{}},c=new ix;var iM=45e3,iP={},iF={};function iV(e,t,n){e.L=1,e.v=i2(iJ(t)),e.s=n,e.S=!0,iU(e,null)}function iU(e,t){e.G=Date.now(),i$(e),e.A=iJ(e.v);var n=e.A,i=e.W;Array.isArray(i)||(i=[String(i)]),rs(n.i,"t",i),e.C=0,n=e.l.J,e.h=new iO,e.g=r4(e.l,n?t:null,!e.s),0<e.O&&(e.M=new io(nu(e.Pa,e,e.g),e.O)),iu(e.U,e.g,"readystatechange",e.nb),t=e.I?nj(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),iw(),function(e,t,n,i,r,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var h=o[l].split("=");if(1<h.length){var u=h[0];h=h[1];var c=u.split("_");a=2<=c.length&&"type"==c[1]?a+(u+"=")+h+"&":a+(u+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+a})}(e.j,e.u,e.A,e.m,e.W,e.s)}function iB(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function ij(e,t,n){let i=!0,r;for(;!e.J&&e.C<n.length;)if((r=function(e,t){var n=e.C,i=t.indexOf("\n",n);return -1==i?iF:isNaN(n=Number(t.substring(n,i)))?iP:(i+=1)+n>t.length?iF:(t=t.slice(i,i+n),e.C=i+n,t)}(e,n))==iF){4==t&&(e.o=4,iE(14),i=!1),ip(e.j,e.m,null,"[Incomplete Response]");break}else if(r==iP){e.o=4,iE(15),ip(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}else ip(e.j,e.m,r,null),iG(e,r);iB(e)&&r!=iF&&r!=iP&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,iE(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),rX(t),t.M=!0,iE(11))):(ip(e.j,e.m,n,"[Invalid Chunked Response]"),iH(e),iK(e))}function i$(e){e.Y=Date.now()+e.P,iq(e,e.P)}function iq(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=iI(nu(e.lb,e),t)}function iz(e){e.B&&(ns.clearTimeout(e.B),e.B=null)}function iK(e){0==e.l.H||e.J||rZ(e.l,e)}function iH(e){iz(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,is(e.V),ic(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function iG(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||rd(n.i,e))){if(!e.K&&rd(n.i,e)&&3==n.H){try{var i=n.Ja.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(n.g.G+3e3<e.G)rY(n),r$(n);else break e}rW(n),iE(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=iI(nu(n.ib,n),6e3));if(1>=rc(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else r1(n,11)}else if((e.K||n.g==e)&&rY(n),!nw(t))for(r=n.Ja.g.parse(t),t=0;t<r.length;t++){let o=r[t];if(n.V=o[0],o=o[1],2==n.H){if("c"==o[0]){n.K=o[1],n.pa=o[2];let t=o[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let r=o[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(i=1.5*l,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(rf(s,s.h),s.h=null))}if(i.F){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.Da=e,i1(i.I,i.F,e))}}if(n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),(i=n).wa=r9(i,i.J?i.pa:null,i.Y),e.K){rp(i.i,e);var a=i.L;a&&e.setTimeout(a),e.B&&(iz(e),i$(e)),i.g=e}else rQ(i);0<n.j.length&&rz(n)}else"stop"!=o[0]&&"close"!=o[0]||r1(n,7)}else 3==n.H&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?r1(n,7):rj(n):"noop"!=o[0]&&n.h&&n.h.Aa(o),n.A=0)}}iw(4)}catch(e){}}function iQ(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(na(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(na(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let i in t=[],n=0,e)t[n++]=i;return t}}}(e),i=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(na(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}(nt=iR.prototype).setTimeout=function(e){this.P=e},nt.nb=function(e){e=e.target;let t=this.M;t&&3==rM(e)?t.l():this.Pa(e)},nt.Pa=function(e){try{if(e==this.g)e:{let u=rM(this.g);var t=this.g.Ia();let c=this.g.da();if(!(3>u)&&(3!=u||nS||this.g&&(this.h.h||this.g.ja()||rP(this.g)))){this.J||4!=u||7==t||(8==t||0>=c?iw(3):iw(2)),iz(this);var n=this.g.da();this.ca=n;t:if(iB(this)){var i=rP(this.g);e="";var r=i.length,s=4==rM(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){iH(this),iK(this);var a="";break t}this.h.i=new ns.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.splice(0,r),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=200==n,function(e,t,n,i,r,s,a){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+a})}(this.j,this.u,this.A,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,l=this.g;if((o=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!nw(o)){var h=o;break t}}h=null}if(n=h)ip(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,iG(this,n);else{this.i=!1,this.o=3,iE(12),iH(this),iK(this);break e}}this.S?(ij(this,u,a),nS&&this.i&&3==u&&(iu(this.U,this.V,"tick",this.mb),this.V.start())):(ip(this.j,this.m,a,null),iG(this,a)),4==u&&iH(this),this.i&&!this.J&&(4==u?rZ(this.l,this):(this.i=!1,i$(this)))}else(function(e){let t={};e=(e.g&&2<=rM(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(nw(e[i]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[i]);let r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[r]||[];t[r]=s,s.push(n)}!function(e,t){for(let n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.o=3,iE(12)):(this.o=0,iE(13)),iH(this),iK(this)}}}catch(e){}finally{}},nt.mb=function(){if(this.g){var e=rM(this.g),t=this.g.ja();this.C<t.length&&(iz(this),ij(this,e,t),this.i&&4!=e&&i$(this))}},nt.cancel=function(){this.J=!0,iH(this)},nt.lb=function(){this.B=null;let e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.L&&(iw(),iE(17)),iH(this),this.o=2,iK(this)):iq(this,this.Y-e)};var iW=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function iX(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof iX){this.h=e.h,iY(this,e.j),this.s=e.s,this.g=e.g,iZ(this,e.m),this.l=e.l;var t=e.i,n=new rt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),i0(this,n),this.o=e.o}else e&&(t=String(e).match(iW))?(this.h=!1,iY(this,t[1]||"",!0),this.s=i9(t[2]||""),this.g=i9(t[3]||"",!0),iZ(this,t[4]),this.l=i9(t[5]||"",!0),i0(this,t[6]||"",!0),this.o=i9(t[7]||"")):(this.h=!1,this.i=new rt(null,this.h))}function iJ(e){return new iX(e)}function iY(e,t,n){e.j=n?i9(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function iZ(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function i0(e,t,n){var i,r;t instanceof rt?(e.i=t,i=e.i,(r=e.h)&&!i.j&&(rn(i),i.i=null,i.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(ri(this,t),rs(this,n,e))},i)),i.j=r):(n||(t=i4(t,i8)),e.i=new rt(t,e.h))}function i1(e,t,n){e.i.set(t,n)}function i2(e){return i1(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function i9(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function i4(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,i6),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function i6(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}iX.prototype.toString=function(){var e=[],t=this.j;t&&e.push(i4(t,i5,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(i4(t,i5,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(i4(n,"/"==n.charAt(0)?i7:i3,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",i4(n,re)),e.join("")};var i5=/[#\/\?@]/g,i3=/[#\?:]/g,i7=/[#\?]/g,i8=/[#\?@]/g,re=/#/g;function rt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function rn(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ri(e,t){rn(e),t=ra(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function rr(e,t){return rn(e),t=ra(e,t),e.g.has(t)}function rs(e,t,n){ri(e,t),0<n.length&&(e.i=null,e.g.set(ra(e,t),ng(n)),e.h+=n.length)}function ra(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(nt=rt.prototype).add=function(e,t){rn(this),this.i=null,e=ra(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},nt.forEach=function(e,t){rn(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},nt.ta=function(){rn(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){let r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},nt.Z=function(e){rn(this);let t=[];if("string"==typeof e)rr(this,e)&&(t=t.concat(this.g.get(ra(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},nt.set=function(e,t){return rn(this),this.i=null,rr(this,e=ra(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},nt.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},nt.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];let s=encodeURIComponent(String(i)),a=this.Z(i);for(i=0;i<a.length;i++){var r=s;""!==a[i]&&(r+="="+encodeURIComponent(String(a[i]))),e.push(r)}}return this.i=e.join("&")};var ro=class{constructor(e,t){this.g=e,this.map=t}};function rl(e){this.l=e||rh,e=ns.PerformanceNavigationTiming?0<(e=ns.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(ns.g&&ns.g.Ka&&ns.g.Ka()&&ns.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var rh=10;function ru(e){return!!e.h||!!e.g&&e.g.size>=e.j}function rc(e){return e.h?1:e.g?e.g.size:0}function rd(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function rf(e,t){e.g?e.g.add(t):e.h=t}function rp(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function rg(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return ng(e.i)}rl.prototype.cancel=function(){if(this.i=rg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var rm=class{stringify(e){return ns.JSON.stringify(e,void 0)}parse(e){return ns.JSON.parse(e,void 0)}};function ry(){this.g=new rm}function rv(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(e){}}function rw(e){this.l=e.fc||null,this.j=e.ob||!1}function rb(e,t){n2.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=rE,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}nd(rw,iS),rw.prototype.g=function(){return new rb(this.l,this.j)},rw.prototype.i=(l={},function(){return l}),nd(rb,n2);var rE=0;function rT(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function rI(e){e.readyState=4,e.l=null,e.j=null,e.A=null,r_(e)}function r_(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(nt=rb.prototype).open=function(e,t){if(this.readyState!=rE)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,r_(this)},nt.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||ns).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},nt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,rI(this)),this.readyState=rE},nt.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,r_(this)),this.g&&(this.readyState=3,r_(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==ns.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;rT(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))}},nt.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?rI(this):r_(this),3==this.readyState&&rT(this)}},nt.Za=function(e){this.g&&(this.response=this.responseText=e,rI(this))},nt.Ya=function(e){this.g&&(this.response=e,rI(this))},nt.ka=function(){this.g&&rI(this)},nt.setRequestHeader=function(e,t){this.v.append(e,t)},nt.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},nt.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(rb.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var rC=ns.JSON.parse;function rS(e){n2.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=rA,this.L=this.M=!1}nd(rS,n2);var rA="",rD=/^https?$/i,rk=["POST","PUT"];function rN(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,rL(e),rR(e)}function rL(e){e.F||(e.F=!0,n9(e,"complete"),n9(e,"error"))}function rx(e){if(e.h&&void 0!==nr&&(!e.C[1]||4!=rM(e)||2!=e.da())){if(e.v&&4==rM(e))ia(e.La,0,e);else if(n9(e,"readystatechange"),4==rM(e)){e.h=!1;try{let a=e.da();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,i=!0;break;default:i=!1}if(!(t=i)){if(n=0===a){var r=String(e.I).match(iW)[1]||null;!r&&ns.self&&ns.self.location&&(r=ns.self.location.protocol.slice(0,-1)),n=!rD.test(r?r.toLowerCase():"")}t=n}if(t)n9(e,"complete"),n9(e,"success");else{e.m=6;try{var s=2<rM(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",rL(e)}}finally{rR(e)}}}}function rR(e,t){if(e.g){rO(e);let n=e.g,i=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||n9(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function rO(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(ns.clearTimeout(e.A),e.A=null)}function rM(e){return e.g?e.g.readyState:0}function rP(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case rA:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function rF(e){let t="";return nB(e,function(e,n){t+=n+":"+e+"\r\n"}),t}function rV(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=rF(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):i1(e,t,n))}function rU(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function rB(e){this.Ga=0,this.j=[],this.l=new id,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=rU("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=rU("baseRetryDelayMs",5e3,e),this.hb=rU("retryDelaySeedMs",1e4,e),this.eb=rU("forwardChannelMaxRetries",2,e),this.xa=rU("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new rl(e&&e.concurrentRequestLimit),this.Ja=new ry,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function rj(e){if(rq(e),3==e.H){var t=e.W++,n=iJ(e.I);if(i1(n,"SID",e.K),i1(n,"RID",t),i1(n,"TYPE","terminate"),rH(e,n),(t=new iR(e,e.l,t)).L=2,t.v=i2(iJ(n)),n=!1,ns.navigator&&ns.navigator.sendBeacon)try{n=ns.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&ns.Image&&((new Image).src=t.v,n=!0),n||(t.g=r4(t.l,null),t.g.ha(t.v)),t.G=Date.now(),i$(t)}r2(e)}function r$(e){e.g&&(rX(e),e.g.cancel(),e.g=null)}function rq(e){r$(e),e.u&&(ns.clearTimeout(e.u),e.u=null),rY(e),e.i.cancel(),e.m&&("number"==typeof e.m&&ns.clearTimeout(e.m),e.m=null)}function rz(e){if(!ru(e.i)&&!e.m){e.m=!0;var t=e.Na;n7||it(),n8||(n7(),n8=!0),ie.add(t,e),e.C=0}}function rK(e,t){var n;n=t?t.m:e.W++;let i=iJ(e.I);i1(i,"SID",e.K),i1(i,"RID",n),i1(i,"AID",e.V),rH(e,i),e.o&&e.s&&rV(i,e.o,e.s),n=new iR(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=rG(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),rf(e.i,n),iV(n,i,t)}function rH(e,t){e.na&&nB(e.na,function(e,n){i1(t,n,e)}),e.h&&iQ({},function(e,n){i1(t,n,e)})}function rG(e,t,n){n=Math.min(e.j.length,n);var i=e.h?nu(e.h.Va,e.h,e):null;e:{var r=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=r[a].g,o=r[a].map;if(0>(n-=t))t=Math.max(0,r[a].g-100),s=!1;else try{!function(e,t,n){let i=n||"";try{iQ(e,function(e,n){let r=e;no(e)&&(r=n6(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){i&&i(o)}}if(s){i=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,i}function rQ(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;n7||it(),n8||(n7(),n8=!0),ie.add(t,e),e.A=0}}function rW(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.ba++,e.u=iI(nu(e.Ma,e),r0(e,e.A)),e.A++,!0)}function rX(e){null!=e.B&&(ns.clearTimeout(e.B),e.B=null)}function rJ(e){e.g=new iR(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=iJ(e.wa);i1(t,"RID","rpc"),i1(t,"SID",e.K),i1(t,"AID",e.V),i1(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&i1(t,"TO",e.qa),i1(t,"TYPE","xmlhttp"),rH(e,t),e.o&&e.s&&rV(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=i2(iJ(t)),n.s=null,n.S=!0,iU(n,e)}function rY(e){null!=e.v&&(ns.clearTimeout(e.v),e.v=null)}function rZ(e,t){var n=null;if(e.g==t){rY(e),rX(e),e.g=null;var i=2}else{if(!rd(e.i,t))return;n=t.F,rp(e.i,t),i=1}if(0!=e.H){if(t.i){if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.G;var r,s=e.C;n9(i=iy(),new iT(i,n)),rz(e)}else rQ(e)}else if(3==(s=t.o)||0==s&&0<t.ca||!(1==i&&(r=t,!(rc(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=r.F.concat(e.j),!0):1!=e.H&&2!=e.H&&!(e.C>=(e.cb?0:e.eb))&&(e.m=iI(nu(e.Na,e,r),r0(e,e.C)),e.C++,!0)))||2==i&&rW(e)))switch(n&&0<n.length&&((t=e.i).i=t.i.concat(n)),s){case 1:r1(e,5);break;case 4:r1(e,10);break;case 3:r1(e,6);break;default:r1(e,2)}}}function r0(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function r1(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var i=nu(e.pb,e);n||(n=new iX("//www.google.com/images/cleardot.gif"),ns.location&&"http"==ns.location.protocol||iY(n,"https"),i2(n)),function(e,t){let n=new id;if(ns.Image){let i=new Image;i.onload=nc(rv,n,i,"TestLoadImage: loaded",!0,t),i.onerror=nc(rv,n,i,"TestLoadImage: error",!1,t),i.onabort=nc(rv,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=nc(rv,n,i,"TestLoadImage: timeout",!1,t),ns.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(n.toString(),i)}else iE(2);e.H=0,e.h&&e.h.za(t),r2(e),rq(e)}function r2(e){if(e.H=0,e.ma=[],e.h){let t=rg(e.i);(0!=t.length||0!=e.j.length)&&(nm(e.ma,t),nm(e.ma,e.j),e.i.i.length=0,ng(e.j),e.j.length=0),e.h.ya()}}function r9(e,t,n){var i=n instanceof iX?iJ(n):new iX(n);if(""!=i.g)t&&(i.g=t+"."+i.g),iZ(i,i.m);else{var r=ns.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new iX(null);i&&iY(s,i),t&&(s.g=t),r&&iZ(s,r),n&&(s.l=n),i=s}return n=e.F,t=e.Da,n&&t&&i1(i,n,t),i1(i,"VER",e.ra),rH(e,i),i}function r4(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new rS(n&&e.Ha&&!e.va?new rw({ob:!0}):e.va)).Oa(e.J),t}function r6(){}function r5(){if(n_&&!(10<=Number(nR)))throw Error("Environmental error: no available transport.")}function r3(e,t){n2.call(this),this.g=new rB(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!nw(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!nw(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new se(this)}function r7(e){iN.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function r8(){iL.call(this),this.status=1}function se(e){this.g=e}function st(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function sn(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],a=t+(s^n&(r^s))+i[0]+3614090360&4294967295;a=s+(r^(t=n+(a<<7&4294967295|a>>>25))&(n^r))+i[1]+3905402710&4294967295,a=r+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+i[2]+606105819&4294967295,a=n+(t^(r=s+(a<<17&4294967295|a>>>15))&(s^t))+i[3]+3250441966&4294967295,a=t+(s^(n=r+(a<<22&4294967295|a>>>10))&(r^s))+i[4]+4118548399&4294967295,a=s+(r^(t=n+(a<<7&4294967295|a>>>25))&(n^r))+i[5]+1200080426&4294967295,a=r+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+i[6]+2821735955&4294967295,a=n+(t^(r=s+(a<<17&4294967295|a>>>15))&(s^t))+i[7]+4249261313&4294967295,a=t+(s^(n=r+(a<<22&4294967295|a>>>10))&(r^s))+i[8]+1770035416&4294967295,a=s+(r^(t=n+(a<<7&4294967295|a>>>25))&(n^r))+i[9]+2336552879&4294967295,a=r+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+i[10]+4294925233&4294967295,a=n+(t^(r=s+(a<<17&4294967295|a>>>15))&(s^t))+i[11]+2304563134&4294967295,a=t+(s^(n=r+(a<<22&4294967295|a>>>10))&(r^s))+i[12]+1804603682&4294967295,a=s+(r^(t=n+(a<<7&4294967295|a>>>25))&(n^r))+i[13]+4254626195&4294967295,a=r+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+i[14]+2792965006&4294967295,a=n+(t^(r=s+(a<<17&4294967295|a>>>15))&(s^t))+i[15]+1236535329&4294967295,n=r+(a<<22&4294967295|a>>>10),a=t+(r^s&(n^r))+i[1]+4129170786&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^r&(t^n))+i[6]+3225465664&4294967295,s=t+(a<<9&4294967295|a>>>23),a=r+(t^n&(s^t))+i[11]+643717713&4294967295,r=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(r^s))+i[0]+3921069994&4294967295,n=r+(a<<20&4294967295|a>>>12),a=t+(r^s&(n^r))+i[5]+3593408605&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^r&(t^n))+i[10]+38016083&4294967295,s=t+(a<<9&4294967295|a>>>23),a=r+(t^n&(s^t))+i[15]+3634488961&4294967295,r=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(r^s))+i[4]+3889429448&4294967295,n=r+(a<<20&4294967295|a>>>12),a=t+(r^s&(n^r))+i[9]+568446438&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^r&(t^n))+i[14]+3275163606&4294967295,s=t+(a<<9&4294967295|a>>>23),a=r+(t^n&(s^t))+i[3]+4107603335&4294967295,r=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(r^s))+i[8]+1163531501&4294967295,n=r+(a<<20&4294967295|a>>>12),a=t+(r^s&(n^r))+i[13]+2850285829&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^r&(t^n))+i[2]+4243563512&4294967295,s=t+(a<<9&4294967295|a>>>23),a=r+(t^n&(s^t))+i[7]+1735328473&4294967295,r=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(r^s))+i[12]+2368359562&4294967295,a=t+((n=r+(a<<20&4294967295|a>>>12))^r^s)+i[5]+4294588738&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^r)+i[8]+2272392833&4294967295,a=r+((s=t+(a<<11&4294967295|a>>>21))^t^n)+i[11]+1839030562&4294967295,a=n+((r=s+(a<<16&4294967295|a>>>16))^s^t)+i[14]+4259657740&4294967295,a=t+((n=r+(a<<23&4294967295|a>>>9))^r^s)+i[1]+2763975236&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^r)+i[4]+1272893353&4294967295,a=r+((s=t+(a<<11&4294967295|a>>>21))^t^n)+i[7]+4139469664&4294967295,a=n+((r=s+(a<<16&4294967295|a>>>16))^s^t)+i[10]+3200236656&4294967295,a=t+((n=r+(a<<23&4294967295|a>>>9))^r^s)+i[13]+681279174&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^r)+i[0]+3936430074&4294967295,a=r+((s=t+(a<<11&4294967295|a>>>21))^t^n)+i[3]+3572445317&4294967295,a=n+((r=s+(a<<16&4294967295|a>>>16))^s^t)+i[6]+76029189&4294967295,a=t+((n=r+(a<<23&4294967295|a>>>9))^r^s)+i[9]+3654602809&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^r)+i[12]+3873151461&4294967295,a=r+((s=t+(a<<11&4294967295|a>>>21))^t^n)+i[15]+530742520&4294967295,a=n+((r=s+(a<<16&4294967295|a>>>16))^s^t)+i[2]+3299628645&4294967295,n=r+(a<<23&4294967295|a>>>9),a=t+(r^(n|~s))+i[0]+4096336452&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~r))+i[7]+1126891415&4294967295,s=t+(a<<10&4294967295|a>>>22),a=r+(t^(s|~n))+i[14]+2878612391&4294967295,r=s+(a<<15&4294967295|a>>>17),a=n+(s^(r|~t))+i[5]+4237533241&4294967295,n=r+(a<<21&4294967295|a>>>11),a=t+(r^(n|~s))+i[12]+1700485571&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~r))+i[3]+2399980690&4294967295,s=t+(a<<10&4294967295|a>>>22),a=r+(t^(s|~n))+i[10]+4293915773&4294967295,r=s+(a<<15&4294967295|a>>>17),a=n+(s^(r|~t))+i[1]+2240044497&4294967295,n=r+(a<<21&4294967295|a>>>11),a=t+(r^(n|~s))+i[8]+1873313359&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~r))+i[15]+4264355552&4294967295,s=t+(a<<10&4294967295|a>>>22),a=r+(t^(s|~n))+i[6]+2734768916&4294967295,r=s+(a<<15&4294967295|a>>>17),a=n+(s^(r|~t))+i[13]+1309151649&4294967295,n=r+(a<<21&4294967295|a>>>11),a=t+(r^(n|~s))+i[4]+4149444226&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~r))+i[11]+3174756917&4294967295,s=t+(a<<10&4294967295|a>>>22),a=r+(t^(s|~n))+i[2]+718787259&4294967295,r=s+(a<<15&4294967295|a>>>17),a=n+(s^(r|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+s&4294967295}function si(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}(nt=rS.prototype).Oa=function(e){this.M=e},nt.ha=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():c.g(),this.C=this.u?iA(this.u):iA(c),this.g.onreadystatechange=nu(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){rN(this,e);return}if(e=n||"",n=new Map(this.headers),i){if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i))}for(let[s,a]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=ns.FormData&&e instanceof ns.FormData,!(0<=np(rk,t))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{var s;rO(this),0<this.B&&((this.L=(s=this.g,n_&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=nu(this.ua,this)):this.A=ia(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){rN(this,e)}},nt.ua=function(){void 0!==nr&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,n9(this,"timeout"),this.abort(8))},nt.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,n9(this,"complete"),n9(this,"abort"),rR(this))},nt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),rR(this,!0)),rS.$.N.call(this)},nt.La=function(){this.s||(this.G||this.v||this.l?rx(this):this.kb())},nt.kb=function(){rx(this)},nt.isActive=function(){return!!this.g},nt.da=function(){try{return 2<rM(this)?this.g.status:-1}catch(e){return -1}},nt.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},nt.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),rC(t)}},nt.Ia=function(){return this.m},nt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(nt=rB.prototype).ra=8,nt.H=1,nt.Na=function(e){if(this.m){if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let r=new iR(this,this.l,e),s=this.s;if(this.U&&(s?nq(s=nj(s),this.U):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){t:{var i=this.j[n];if("__data__"in i.map&&"string"==typeof(i=i.map.__data__)){i=i.length;break t}i=void 0}if(void 0===i)break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=rG(this,r,t),i1(n=iJ(this.I),"RID",e),i1(n,"CVER",22),this.F&&i1(n,"X-HTTP-Session-Id",this.F),rH(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(rF(s)))+"&"+t:this.o&&rV(n,this.o,s)),rf(this.i,r),this.bb&&i1(n,"TYPE","init"),this.P?(i1(n,"$req",t),i1(n,"SID","null"),r.aa=!0,iV(r,n,null)):iV(r,n,t),this.H=2}}else 3==this.H&&(e?rK(this,e):0==this.j.length||ru(this.i)||rK(this))}},nt.Ma=function(){if(this.u=null,rJ(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=iI(nu(this.jb,this),e)}},nt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,iE(10),r$(this),rJ(this))},nt.ib=function(){null!=this.v&&(this.v=null,r$(this),rW(this),iE(19))},nt.pb=function(e){e?(this.l.info("Successfully pinged google.com"),iE(2)):(this.l.info("Failed to ping google.com"),iE(1))},nt.isActive=function(){return!!this.h&&this.h.isActive(this)},(nt=r6.prototype).Ba=function(){},nt.Aa=function(){},nt.za=function(){},nt.ya=function(){},nt.isActive=function(){return!0},nt.Va=function(){},r5.prototype.g=function(e,t){return new r3(e,t)},nd(r3,n2),r3.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;iE(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=r9(e,null,e.Y),rz(e)},r3.prototype.close=function(){rj(this.g)},r3.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=n6(e),e=n);t.j.push(new ro(t.fb++,e)),3==t.H&&rz(t)},r3.prototype.N=function(){this.g.h=null,delete this.j,rj(this.g),delete this.g,r3.$.N.call(this)},nd(r7,iN),nd(r8,iL),nd(se,r6),se.prototype.Ba=function(){n9(this.g,"a")},se.prototype.Aa=function(e){n9(this.g,new r7(e))},se.prototype.za=function(e){n9(this.g,new r8)},se.prototype.ya=function(){n9(this.g,"b")},nd(st,function(){this.blockSize=-1}),st.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},st.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.m,r=this.h,s=0;s<t;){if(0==r)for(;s<=n;)sn(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(i[r++]=e.charCodeAt(s++),r==this.blockSize){sn(this,i),r=0;break}}else for(;s<t;)if(i[r++]=e[s++],r==this.blockSize){sn(this,i),r=0;break}}this.h=r,this.i+=t},st.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var sr={};function ss(e){return -128<=e&&128>e?Object.prototype.hasOwnProperty.call(sr,e)?sr[e]:sr[e]=new si([0|e],0>e?-1:0):new si([0|e],0>e?-1:0)}function sa(e){if(isNaN(e)||!isFinite(e))return sl;if(0>e)return sf(sa(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=so;return new si(t,0)}var so=4294967296,sl=ss(0),sh=ss(1),su=ss(16777216);function sc(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function sd(e){return -1==e.h}function sf(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new si(n,~e.h).add(sh)}function sp(e,t){return e.add(sf(t))}function sg(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function sm(e,t){this.g=e,this.h=t}function sy(e,t){if(sc(t))throw Error("division by zero");if(sc(e))return new sm(sl,sl);if(sd(e))return t=sy(sf(e),t),new sm(sf(t.g),sf(t.h));if(sd(t))return t=sy(e,sf(t)),new sm(sf(t.g),t.h);if(30<e.g.length){if(sd(e)||sd(t))throw Error("slowDivide_ only works with positive integers.");for(var n=sh,i=t;0>=i.X(e);)n=sv(n),i=sv(i);var r=sw(n,1),s=sw(i,1);for(i=sw(i,2),n=sw(n,2);!sc(i);){var a=s.add(i);0>=a.X(e)&&(r=r.add(n),s=a),i=sw(i,1),n=sw(n,1)}return t=sp(e,r.R(t)),new sm(r,t)}for(r=sl;0<=e.X(t);){for(i=48>=(i=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,i-48),a=(s=sa(n)).R(t);sd(a)||0<a.X(e);)n-=i,a=(s=sa(n)).R(t);sc(s)&&(s=sh),r=r.add(s),e=sp(e,a)}return new sm(r,e)}function sv(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.D(i)<<1|e.D(i-1)>>>31;return new si(n,e.h)}function sw(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,r=[],s=0;s<i;s++)r[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new si(r,e.h)}(nt=si.prototype).ea=function(){if(sd(this))return-sf(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.D(n);e+=(0<=i?i:so+i)*t,t*=so}return e},nt.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(sc(this))return"0";if(sd(this))return"-"+sf(this).toString(e);for(var t=sa(Math.pow(e,6)),n=this,i="";;){var r=sy(n,t).g,s=((0<(n=sp(n,r.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(sc(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},nt.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},nt.X=function(e){return sd(e=sp(this,e))?-1:sc(e)?0:1},nt.abs=function(){return sd(this)?sf(this):this},nt.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,r=0;r<=t;r++){var s=i+(65535&this.D(r))+(65535&e.D(r)),a=(s>>>16)+(this.D(r)>>>16)+(e.D(r)>>>16);i=a>>>16,s&=65535,a&=65535,n[r]=a<<16|s}return new si(n,-2147483648&n[n.length-1]?-1:0)},nt.R=function(e){if(sc(this)||sc(e))return sl;if(sd(this))return sd(e)?sf(this).R(sf(e)):sf(sf(this).R(e));if(sd(e))return sf(this.R(sf(e)));if(0>this.X(su)&&0>e.X(su))return sa(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<e.g.length;r++){var s=this.D(i)>>>16,a=65535&this.D(i),o=e.D(r)>>>16,l=65535&e.D(r);n[2*i+2*r]+=a*l,sg(n,2*i+2*r),n[2*i+2*r+1]+=s*l,sg(n,2*i+2*r+1),n[2*i+2*r+1]+=a*o,sg(n,2*i+2*r+1),n[2*i+2*r+2]+=s*o,sg(n,2*i+2*r+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new si(n,0)},nt.gb=function(e){return sy(this,e).h},nt.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)&e.D(i);return new si(n,this.h&e.h)},nt.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)|e.D(i);return new si(n,this.h|e.h)},nt.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)^e.D(i);return new si(n,this.h^e.h)},r5.prototype.createWebChannel=r5.prototype.g,r3.prototype.send=r3.prototype.u,r3.prototype.open=r3.prototype.m,r3.prototype.close=r3.prototype.close,i_.NO_ERROR=0,i_.TIMEOUT=8,i_.HTTP_ERROR=6,iC.COMPLETE="complete",iD.EventType=ik,ik.OPEN="a",ik.CLOSE="b",ik.ERROR="c",ik.MESSAGE="d",n2.prototype.listen=n2.prototype.O,rS.prototype.listenOnce=rS.prototype.P,rS.prototype.getLastError=rS.prototype.Sa,rS.prototype.getLastErrorCode=rS.prototype.Ia,rS.prototype.getStatus=rS.prototype.da,rS.prototype.getResponseJson=rS.prototype.Wa,rS.prototype.getResponseText=rS.prototype.ja,rS.prototype.send=rS.prototype.ha,rS.prototype.setWithCredentials=rS.prototype.Oa,st.prototype.digest=st.prototype.l,st.prototype.reset=st.prototype.reset,st.prototype.update=st.prototype.j,si.prototype.add=si.prototype.add,si.prototype.multiply=si.prototype.R,si.prototype.modulo=si.prototype.gb,si.prototype.compare=si.prototype.X,si.prototype.toNumber=si.prototype.ea,si.prototype.toString=si.prototype.toString,si.prototype.getBits=si.prototype.D,si.fromNumber=sa,si.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return sf(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=sa(Math.pow(n,8)),r=sl,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=sa(Math.pow(n,a)),r=r.R(a).add(sa(o))):r=(r=r.R(i)).add(sa(o))}return r};var sb=ni.createWebChannelTransport=function(){return new r5},sE=ni.getStatEventTarget=function(){return iy()},sT=ni.ErrorCode=i_,sI=ni.EventType=iC,s_=ni.Event=ig,sC=ni.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},sS=ni.FetchXmlHttpFactory=rw,sA=ni.WebChannel=iD,sD=ni.XhrIo=rS,sk=ni.Md5=st,sN=ni.Integer=si;const sL="@firebase/firestore";class sx{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}sx.UNAUTHENTICATED=new sx(null),sx.GOOGLE_CREDENTIALS=new sx("google-credentials-uid"),sx.FIRST_PARTY=new sx("first-party-uid"),sx.MOCK_USER=new sx("mock-user");let sR="10.1.0";const sO=new ea("@firebase/firestore");function sM(){return sO.logLevel}function sP(e,...t){if(sO.logLevel<=ne.DEBUG){let n=t.map(sU);sO.debug(`Firestore (${sR}): ${e}`,...n)}}function sF(e,...t){if(sO.logLevel<=ne.ERROR){let n=t.map(sU);sO.error(`Firestore (${sR}): ${e}`,...n)}}function sV(e,...t){if(sO.logLevel<=ne.WARN){let n=t.map(sU);sO.warn(`Firestore (${sR}): ${e}`,...n)}}function sU(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function sB(e="Unexpected state"){let t=`FIRESTORE (${sR}) INTERNAL ASSERTION FAILED: `+e;throw sF(t),Error(t)}const sj={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class s$ extends z{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class sq{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class sz{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sK{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(sx.UNAUTHENTICATED))}shutdown(){}}class sH{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class sG{constructor(e){this.t=e,this.currentUser=sx.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),r=new sq;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new sq,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},a=e=>{sP("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(sP("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new sq)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(sP("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||sB(),new sz(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||sB(),new sx(e)}}class sQ{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=sx.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class sW{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new sQ(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(sx.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class sX{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class sJ{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=e=>{null!=e.error&&sP("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.R;return this.R=e.token,sP("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let i=e=>{sP("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){let e=this.A.getImmediate({optional:!0});e?i(e):sP("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||sB(),this.R=e.token,new sX(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class sY{static V(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%e.length))}return n}}function sZ(e,t){return e<t?-1:e>t?1:0}function s0(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class s1{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new s$(sj.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800||e>=253402300800)throw new s$(sj.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return s1.fromMillis(Date.now())}static fromDate(e){return s1.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new s1(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?sZ(this.nanoseconds,e.nanoseconds):sZ(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class s2{constructor(e){this.timestamp=e}static fromTimestamp(e){return new s2(e)}static min(){return new s2(new s1(0,0))}static max(){return new s2(new s1(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class s9{constructor(e,t,n){void 0===t?t=0:t>e.length&&sB(),void 0===n?n=e.length-t:n>e.length-t&&sB(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===s9.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof s9?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let n=e.get(i),r=t.get(i);if(n<r)return -1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class s4 extends s9{construct(e,t,n){return new s4(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new s$(sj.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new s4(t)}static emptyPath(){return new s4([])}}const s6=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class s5 extends s9{construct(e,t,n){return new s5(e,t,n)}static isValidIdentifier(e){return s6.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),s5.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new s5(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,r=()=>{if(0===n.length)throw new s$(sj.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;i<e.length;){let t=e[i];if("\\"===t){if(i+1===e.length)throw new s$(sj.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new s$(sj.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?s=!s:"."!==t||s?n+=t:r(),i++}if(r(),s)throw new s$(sj.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new s5(t)}static emptyPath(){return new s5([])}}class s3{constructor(e){this.path=e}static fromPath(e){return new s3(s4.fromString(e))}static fromName(e){return new s3(s4.fromString(e).popFirst(5))}static empty(){return new s3(s4.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===s4.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return s4.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new s3(new s4(e.slice()))}}class s7{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new s7(s2.min(),s3.empty(),-1)}static max(){return new s7(s2.max(),s3.empty(),-1)}}class s8{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ae(e){if(e.code!==sj.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;sP("LocalStore","Unexpectedly lost primary lease")}class at{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&sB(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new at((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof at?t:at.resolve(t)}catch(e){return at.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):at.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):at.reject(t)}static resolve(e){return new at((t,n)=>{t(e)})}static reject(e){return new at((t,n)=>{n(e)})}static waitFor(e){return new at((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=at.resolve(!1);for(let n of e)t=t.next(e=>e?at.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new at((n,i)=>{let r=e.length,s=Array(r),a=0;for(let o=0;o<r;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new at((n,i)=>{let r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}function an(e){return"IndexedDbTransactionError"===e.name}class ai{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this._e&&this._e(e),e}}function ar(e){return 0===e&&1/e==-1/0}function as(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function aa(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}ai.ae=-1;class ao{constructor(e,t){this.comparator=e,this.root=t||ah.EMPTY}insert(e,t){return new ao(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ah.BLACK,null,null))}remove(e){return new ao(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ah.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new al(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new al(this.root,e,this.comparator,!1)}getReverseIterator(){return new al(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new al(this.root,e,this.comparator,!0)}}class al{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ah{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:ah.RED,this.left=null!=i?i:ah.EMPTY,this.right=null!=r?r:ah.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new ah(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return ah.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return ah.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,ah.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,ah.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw sB();let e=this.left.check();if(e!==this.right.check())throw sB();return e+(this.isRed()?0:1)}}ah.EMPTY=null,ah.RED=!0,ah.BLACK=!1,ah.EMPTY=new class{constructor(){this.size=0}get key(){throw sB()}get value(){throw sB()}get color(){throw sB()}get left(){throw sB()}get right(){throw sB()}copy(e,t,n,i,r){return this}insert(e,t,n){return new ah(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class au{constructor(e){this.comparator=e,this.data=new ao(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ac(this.data.getIterator())}getIteratorFrom(e){return new ac(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof au)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new au(this.comparator);return t.data=e,t}}class ac{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ad{constructor(e){this.fields=e,e.sort(s5.comparator)}static empty(){return new ad([])}unionWith(e){let t=new au(s5.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new ad(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return s0(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class af extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ap{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new af("Invalid base64 string: "+e):e}}(e);return new ap(t)}static fromUint8Array(e){let t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ap(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return sZ(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ap.EMPTY_BYTE_STRING=new ap("");const ag=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function am(e){if(e||sB(),"string"==typeof e){let t=0,n=ag.exec(e);if(n||sB(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}let i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:ay(e.seconds),nanos:ay(e.nanos)}}function ay(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function av(e){return"string"==typeof e?ap.fromBase64String(e):ap.fromUint8Array(e)}function aw(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ab(e){let t=e.mapValue.fields.__previous_value__;return aw(t)?ab(t):t}function aE(e){let t=am(e.mapValue.fields.__local_write_time__.timestampValue);return new s1(t.seconds,t.nanos)}class aT{constructor(e,t,n,i,r,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class aI{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new aI("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof aI&&e.projectId===this.projectId&&e.database===this.database}}const a_={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function aC(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?aw(e)?4:aF(e)?9007199254740991:10:sB()}function aS(e,t){if(e===t)return!0;let n=aC(e);if(n!==aC(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return aE(e).isEqual(aE(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=am(e.timestampValue),i=am(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return av(e.bytesValue).isEqual(av(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return ay(e.geoPointValue.latitude)===ay(t.geoPointValue.latitude)&&ay(e.geoPointValue.longitude)===ay(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ay(e.integerValue)===ay(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=ay(e.doubleValue),i=ay(t.doubleValue);return n===i?ar(n)===ar(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return s0(e.arrayValue.values||[],t.arrayValue.values||[],aS);case 10:return function(e,t){let n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(as(n)!==as(i))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!aS(n[e],i[e])))return!1;return!0}(e,t);default:return sB()}}function aA(e,t){return void 0!==(e.values||[]).find(e=>aS(e,t))}function aD(e,t){if(e===t)return 0;let n=aC(e),i=aC(t);if(n!==i)return sZ(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return sZ(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=ay(e.integerValue||e.doubleValue),i=ay(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return ak(e.timestampValue,t.timestampValue);case 4:return ak(aE(e),aE(t));case 5:return sZ(e.stringValue,t.stringValue);case 6:return function(e,t){let n=av(e),i=av(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){let t=sZ(n[e],i[e]);if(0!==t)return t}return sZ(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=sZ(ay(e.latitude),ay(t.latitude));return 0!==n?n:sZ(ay(e.longitude),ay(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){let n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){let t=aD(n[e],i[e]);if(t)return t}return sZ(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===a_.mapValue&&t===a_.mapValue)return 0;if(e===a_.mapValue)return 1;if(t===a_.mapValue)return -1;let n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){let t=sZ(i[e],s[e]);if(0!==t)return t;let a=aD(n[i[e]],r[s[e]]);if(0!==a)return a}return sZ(i.length,s.length)}(e.mapValue,t.mapValue);default:throw sB()}}function ak(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return sZ(e,t);let n=am(e),i=am(t),r=sZ(n.seconds,i.seconds);return 0!==r?r:sZ(n.nanos,i.nanos)}function aN(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=am(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?av(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,s3.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let i of e.values||[])n?n=!1:t+=",",t+=aN(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",i=!0;for(let r of t)i?i=!1:n+=",",n+=`${r}:${aN(e.fields[r])}`;return n+"}"}(e.mapValue):sB()}function aL(e){return!!e&&"integerValue"in e}function ax(e){return!!e&&"arrayValue"in e}function aR(e){return!!e&&"nullValue"in e}function aO(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function aM(e){return!!e&&"mapValue"in e}function aP(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return aa(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=aP(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=aP(e.arrayValue.values[n]);return t}return Object.assign({},e)}function aF(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class aV{constructor(e){this.value=e}static empty(){return new aV({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!aM(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=aP(t)}setAll(e){let t=s5.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){let e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=aP(e):i.push(r.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){let t=this.field(e.popLast());aM(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return aS(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];aM(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(aa(t,(t,n)=>e[t]=n),n))delete e[i]}clone(){return new aV(aP(this.value))}}class aU{constructor(e,t,n,i,r,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=a}static newInvalidDocument(e){return new aU(e,0,s2.min(),s2.min(),s2.min(),aV.empty(),0)}static newFoundDocument(e,t,n,i){return new aU(e,1,t,s2.min(),n,i,0)}static newNoDocument(e,t){return new aU(e,2,t,s2.min(),s2.min(),aV.empty(),0)}static newUnknownDocument(e,t){return new aU(e,3,t,s2.min(),s2.min(),aV.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(s2.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=aV.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=aV.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=s2.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof aU&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new aU(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class aB{constructor(e,t){this.position=e,this.inclusive=t}}function aj(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){let s=t[r],a=e.position[r];if(i=s.field.isKeyField()?s3.comparator(s3.fromName(a.referenceValue),n.key):aD(a,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function a$(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!aS(e.position[n],t.position[n]))return!1;return!0}class aq{constructor(e,t="asc"){this.field=e,this.dir=t}}class az{}class aK extends az{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new aW(e,t,n):"array-contains"===t?new aZ(e,n):"in"===t?new a0(e,n):"not-in"===t?new a1(e,n):"array-contains-any"===t?new a2(e,n):new aK(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new aX(e,n):new aJ(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(aD(t,this.value)):null!==t&&aC(this.value)===aC(t)&&this.matchesComparison(aD(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return sB()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class aH extends az{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new aH(e,t)}matches(e){return aG(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let e=this.le(e=>e.isInequality());return null!==e?e.field:null}le(e){for(let t of this.getFlattenedFilters())if(e(t))return t;return null}}function aG(e){return"and"===e.op}function aQ(e){for(let t of e.filters)if(t instanceof aH)return!1;return!0}class aW extends aK{constructor(e,t,n){super(e,t,n),this.key=s3.fromName(n.referenceValue)}matches(e){let t=s3.comparator(e.key,this.key);return this.matchesComparison(t)}}class aX extends aK{constructor(e,t){super(e,"in",t),this.keys=aY("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aJ extends aK{constructor(e,t){super(e,"not-in",t),this.keys=aY("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aY(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>s3.fromName(e.referenceValue))}class aZ extends aK{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ax(t)&&aA(t.arrayValue,this.value)}}class a0 extends aK{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&aA(this.value.arrayValue,t)}}class a1 extends aK{constructor(e,t){super(e,"not-in",t)}matches(e){if(aA(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!aA(this.value.arrayValue,t)}}class a2 extends aK{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ax(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>aA(this.value.arrayValue,e))}}class a9{constructor(e,t=null,n=[],i=[],r=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=a,this.he=null}}function a4(e,t=null,n=[],i=[],r=null,s=null,a=null){return new a9(e,t,n,i,r,s,a)}function a6(e){if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:"+e.filters.map(e=>(function e(t){if(t instanceof aK)return t.field.canonicalString()+t.op.toString()+aN(t.value);if(aQ(t)&&aG(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(",")+"|ob:"+e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:"+e.limit),e.startAt&&(t+="|lb:"+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(e=>aN(e)).join(",")),e.endAt&&(t+="|ub:"+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(e=>aN(e)).join(",")),e.he=t}return e.he}function a5(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++){var n,i;if(n=e.orderBy[r],i=t.orderBy[r],!(n.dir===i.dir&&n.field.isEqual(i.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof aK?n instanceof aK&&t.op===n.op&&t.field.isEqual(n.field)&&aS(t.value,n.value):t instanceof aH?n instanceof aH&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,i,r)=>t&&e(i,n.filters[r]),!0):void sB()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!a$(e.startAt,t.startAt)&&a$(e.endAt,t.endAt)}function a3(e){return s3.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class a7{constructor(e,t=null,n=[],i=[],r=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=a,this.endAt=o,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function a8(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function oe(e){if(null===e.Pe){e.Pe=[];let t=function(e){for(let t of e.filters){let e=t.getFirstInequalityField();if(null!==e)return e}return null}(e),n=e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null;if(null!==t&&null===n)t.isKeyField()||e.Pe.push(new aq(t)),e.Pe.push(new aq(s5.keyField(),"asc"));else{let t=!1;for(let n of e.explicitOrderBy)e.Pe.push(n),n.field.isKeyField()&&(t=!0);if(!t){let t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new aq(s5.keyField(),t))}}}return e.Pe}function ot(e){if(!e.Ie){if("F"===e.limitType)e.Ie=a4(e.path,e.collectionGroup,oe(e),e.filters,e.limit,e.startAt,e.endAt);else{let t=[];for(let n of oe(e)){let e="desc"===n.dir?"asc":"desc";t.push(new aq(n.field,e))}let n=e.endAt?new aB(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new aB(e.startAt.position,e.startAt.inclusive):null;e.Ie=a4(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}return e.Ie}function on(e,t,n){return new a7(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function oi(e,t){return a5(ot(e),ot(t))&&e.limitType===t.limitType}function or(e){return`${a6(ot(e))}|lt:${e.limitType}`}function os(e){var t;let n;return`Query(target=${n=(t=ot(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof aK?`${t.field.canonicalString()} ${t.op} ${aN(t.value)}`:t instanceof aH?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: "+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>aN(e)).join(",")),t.endAt&&(n+=", endAt: "+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>aN(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function oa(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):s3.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of oe(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let i=aj(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,oe(e),t))&&(!e.endAt||!!function(e,t,n){let i=aj(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,oe(e),t))}function oo(e){return(t,n)=>{let i=!1;for(let r of oe(e)){let e=function(e,t,n){let i=e.field.isKeyField()?s3.comparator(t.key,n.key):function(e,t,n){let i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?aD(i,r):sB()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return -1*i;default:return sB()}}(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}class ol{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,i]of n)if(this.equalsFn(t,e))return i}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){aa(this.inner,(t,n)=>{for(let[t,i]of n)e(t,i)})}isEmpty(){return function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(this.inner)}size(){return this.innerSize}}const oh=new ao(s3.comparator),ou=new ao(s3.comparator);function oc(...e){let t=ou;for(let n of e)t=t.insert(n.key,n);return t}function od(){return new ol(e=>e.toString(),(e,t)=>e.isEqual(t))}new ao(s3.comparator);const of=new au(s3.comparator);function op(...e){let t=of;for(let n of e)t=t.add(n);return t}const og=new au(sZ);class om{constructor(){this._=void 0}}class oy extends om{}class ov extends om{constructor(e){super(),this.elements=e}}function ow(e,t){let n=o_(t);for(let t of e.elements)n.some(e=>aS(e,t))||n.push(t);return{arrayValue:{values:n}}}class ob extends om{constructor(e){super(),this.elements=e}}function oE(e,t){let n=o_(t);for(let t of e.elements)n=n.filter(e=>!aS(e,t));return{arrayValue:{values:n}}}class oT extends om{constructor(e,t){super(),this.serializer=e,this.Te=t}}function oI(e){return ay(e.integerValue||e.doubleValue)}function o_(e){return ax(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class oC{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oC}static exists(e){return new oC(void 0,e)}static updateTime(e){return new oC(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oS(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class oA{}function oD(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new oP(e.key,oC.none()):new oL(e.key,e.data,oC.none());{let n=e.data,i=aV.empty(),r=new au(s5.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new ox(e.key,i,new ad(r.toArray()),oC.none())}}function ok(e,t,n,i){return e instanceof oL?function(e,t,n,i){if(!oS(e.precondition,t))return n;let r=e.value.clone(),s=oM(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof ox?function(e,t,n,i){if(!oS(e.precondition,t))return n;let r=oM(e.fieldTransforms,i,t),s=t.data;return(s.setAll(oR(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):oS(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function oN(e,t){var n,i;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||!(!n||!i)&&s0(n,i,(e,t)=>{var n,i;return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof ov&&i instanceof ov||n instanceof ob&&i instanceof ob?s0(n.elements,i.elements,aS):n instanceof oT&&i instanceof oT?aS(n.Te,i.Te):n instanceof oy&&i instanceof oy)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class oL extends oA{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ox extends oA{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function oR(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let i=e.data.field(n);t.set(n,i)}}),t}function oO(e,t,n){var i;let r=new Map;e.length===n.length||sB();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof ov?ow(o,l):o instanceof ob?oE(o,l):i))}return r}function oM(e,t,n){let i=new Map;for(let r of e){let e=r.transform,s=n.data.field(r.field);i.set(r.field,e instanceof oy?function(e,t){let n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&aw(t)&&(t=ab(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(t,s):e instanceof ov?ow(e,s):e instanceof ob?oE(e,s):function(e,t){var n,i;let r=(n=e,i=t,n instanceof oT?aL(i)||i&&"doubleValue"in i?i:{integerValue:0}:null),s=oI(r)+oI(e.Te);return aL(r)&&aL(e.Te)?{integerValue:""+s}:function(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ar(t)?"-0":t}}(e.serializer,s)}(e,s))}return i}class oP extends oA{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class oF{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];if(r.key.isEqual(e.key)){var i;i=n[t],r instanceof oL?function(e,t,n){let i=e.value.clone(),r=oO(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(r,e,i):r instanceof ox?function(e,t,n){if(!oS(e.precondition,t))return void t.convertToUnknownDocument(n.version);let i=oO(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(oR(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(r,e,i):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,i)}}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=ok(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=ok(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=od();return this.mutations.forEach(i=>{let r=e.get(i.key),s=r.overlayedDocument,a=this.applyToLocalView(s,r.mutatedFields);a=t.has(i.key)?null:a;let o=oD(s,a);null!==o&&n.set(i.key,o),s.isValidDocument()||s.convertToNoDocument(s2.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),op())}isEqual(e){return this.batchId===e.batchId&&s0(this.mutations,e.mutations,(e,t)=>oN(e,t))&&s0(this.baseMutations,e.baseMutations,(e,t)=>oN(e,t))}}class oV{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class oU{constructor(e,t){this.count=e,this.unchangedNames=t}}function oB(e){if(void 0===e)return sF("GRPC error has no .code"),sj.UNKNOWN;switch(e){case d.OK:return sj.OK;case d.CANCELLED:return sj.CANCELLED;case d.UNKNOWN:return sj.UNKNOWN;case d.DEADLINE_EXCEEDED:return sj.DEADLINE_EXCEEDED;case d.RESOURCE_EXHAUSTED:return sj.RESOURCE_EXHAUSTED;case d.INTERNAL:return sj.INTERNAL;case d.UNAVAILABLE:return sj.UNAVAILABLE;case d.UNAUTHENTICATED:return sj.UNAUTHENTICATED;case d.INVALID_ARGUMENT:return sj.INVALID_ARGUMENT;case d.NOT_FOUND:return sj.NOT_FOUND;case d.ALREADY_EXISTS:return sj.ALREADY_EXISTS;case d.PERMISSION_DENIED:return sj.PERMISSION_DENIED;case d.FAILED_PRECONDITION:return sj.FAILED_PRECONDITION;case d.ABORTED:return sj.ABORTED;case d.OUT_OF_RANGE:return sj.OUT_OF_RANGE;case d.UNIMPLEMENTED:return sj.UNIMPLEMENTED;case d.DATA_LOSS:return sj.DATA_LOSS;default:return sB()}}(f=d||(d={}))[f.OK=0]="OK",f[f.CANCELLED=1]="CANCELLED",f[f.UNKNOWN=2]="UNKNOWN",f[f.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",f[f.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",f[f.NOT_FOUND=5]="NOT_FOUND",f[f.ALREADY_EXISTS=6]="ALREADY_EXISTS",f[f.PERMISSION_DENIED=7]="PERMISSION_DENIED",f[f.UNAUTHENTICATED=16]="UNAUTHENTICATED",f[f.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",f[f.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",f[f.ABORTED=10]="ABORTED",f[f.OUT_OF_RANGE=11]="OUT_OF_RANGE",f[f.UNIMPLEMENTED=12]="UNIMPLEMENTED",f[f.INTERNAL=13]="INTERNAL",f[f.UNAVAILABLE=14]="UNAVAILABLE",f[f.DATA_LOSS=15]="DATA_LOSS";class oj{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return o$}static getOrCreateInstance(){return null===o$&&(o$=new oj),o$}onExistenceFilterMismatch(e){let t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let o$=null;const oq=new sN([4294967295,4294967295],0);function oz(e){let t=(new TextEncoder).encode(e),n=new sk;return n.update(t),new Uint8Array(n.digest())}function oK(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new sN([n,i],0),new sN([r,s],0)]}class oH{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new oG(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new oG(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new oG(`Invalid padding when bitmap length is 0: ${t}`);this.de=8*e.length-t,this.Ae=sN.fromNumber(this.de)}Re(e,t,n){let i=e.add(t.multiply(sN.fromNumber(n)));return 1===i.compare(oq)&&(i=new sN([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ae).toNumber()}Ve(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.de)return!1;let t=oz(e),[n,i]=oK(t);for(let e=0;e<this.hashCount;e++){let t=this.Re(n,i,e);if(!this.Ve(t))return!1}return!0}static create(e,t,n){let i=new Uint8Array(Math.ceil(e/8)),r=new oH(i,e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.de)return;let t=oz(e),[n,i]=oK(t);for(let e=0;e<this.hashCount;e++){let t=this.Re(n,i,e);this.me(t)}}me(e){this.bitmap[Math.floor(e/8)]|=1<<e%8}}class oG extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class oQ{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,oW.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new oQ(s2.min(),i,new ao(sZ),oh,op())}}class oW{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new oW(n,t,op(),op(),op())}}class oX{constructor(e,t,n,i){this.fe=e,this.removedTargetIds=t,this.key=n,this.ge=i}}class oJ{constructor(e,t){this.targetId=e,this.pe=t}}class oY{constructor(e,t,n=ap.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class oZ{constructor(){this.ye=0,this.we=o2(),this.Se=ap.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return 0!==this.ye}get Ce(){return this.De}Fe(e){e.approximateByteSize()>0&&(this.De=!0,this.Se=e)}Me(){let e=op(),t=op(),n=op();return this.we.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:sB()}}),new oW(this.Se,this.be,e,t,n)}xe(){this.De=!1,this.we=o2()}Oe(e,t){this.De=!0,this.we=this.we.insert(e,t)}Ne(e){this.De=!0,this.we=this.we.remove(e)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class o0{constructor(e){this.qe=e,this.Qe=new Map,this.Ke=oh,this.$e=o1(),this.Ue=new ao(sZ)}We(e){for(let t of e.fe)e.ge&&e.ge.isFoundDocument()?this.Ge(t,e.ge):this.ze(t,e.key,e.ge);for(let t of e.removedTargetIds)this.ze(t,e.key,e.ge)}je(e){this.forEachTarget(e,t=>{let n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Fe(e.resumeToken);break;case 1:n.Le(),n.ve||n.xe(),n.Fe(e.resumeToken);break;case 2:n.Le(),n.ve||this.removeTarget(t);break;case 3:this.Je(t)&&(n.ke(),n.Fe(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Fe(e.resumeToken));break;default:sB()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qe.forEach((e,n)=>{this.Je(n)&&t(n)})}Ze(e){var t,n;let i=e.targetId,r=e.pe.count,s=this.Xe(i);if(s){let a=s.target;if(a3(a)){if(0===r){let e=new s3(a.path);this.ze(i,e,aU.newNoDocument(e,s2.min()))}else 1===r||sB()}else{let s=this.et(i);if(s!==r){let r=this.tt(e,s);if(0!==r.status){this.Ye(i);let e=2===r.status?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(i,e)}null===(t=oj.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n,i){var r,s,a,o,l,h;let u={localCacheCount:n,existenceFilterCount:i.count},c=i.unchangedNames;return c&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==c?void 0:c.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(a=null===(s=null==c?void 0:c.bits)||void 0===s?void 0:s.bitmap)||void 0===a?void 0:a.length)&&void 0!==o?o:0,padding:null!==(h=null===(l=null==c?void 0:c.bits)||void 0===l?void 0:l.padding)&&void 0!==h?h:0},t&&(u.bloomFilter.mightContain=t)),u}(r.status,null!==(n=r.nt)&&void 0!==n?n:null,s,e.pe))}}}}tt(e,t){let n,i;let{unchangedNames:r,count:s}=e.pe;if(!r||!r.bits)return{status:1};let{bits:{bitmap:a="",padding:o=0},hashCount:l=0}=r;try{n=av(a).toUint8Array()}catch(e){if(e instanceof af)return sV("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw e}try{i=new oH(n,o,l)}catch(e){return sV(e instanceof oG?"BloomFilter error: ":"Applying bloom filter failed: ",e),{status:1}}let h=e=>{let t=this.qe.rt();return i.mightContain(`projects/${t.projectId}/databases/${t.database}/documents/${e}`)};return 0===i.de?{status:1}:{status:s===t-this.it(e.targetId,h)?0:2,nt:h}}it(e,t){let n=this.qe.getRemoteKeysForTarget(e),i=0;return n.forEach(n=>{t(n.path.canonicalString())||(this.ze(e,n,null),i++)}),i}st(e){let t=new Map;this.Qe.forEach((n,i)=>{let r=this.Xe(i);if(r){if(n.current&&a3(r.target)){let t=new s3(r.target.path);null!==this.Ke.get(t)||this.ot(i,t)||this.ze(i,t,aU.newNoDocument(t,e))}n.Ce&&(t.set(i,n.Me()),n.xe())}});let n=op();this.$e.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{let t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.Ke.forEach((t,n)=>n.setReadTime(e));let i=new oQ(e,t,this.Ue,this.Ke,n);return this.Ke=oh,this.$e=o1(),this.Ue=new ao(sZ),i}Ge(e,t){if(!this.Je(e))return;let n=this.ot(e,t.key)?2:0;this.He(e).Oe(t.key,n),this.Ke=this.Ke.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;let i=this.He(e);this.ot(e,t)?i.Oe(t,1):i.Ne(t),this.$e=this.$e.insert(t,this._t(t).delete(e)),n&&(this.Ke=this.Ke.insert(t,n))}removeTarget(e){this.Qe.delete(e)}et(e){let t=this.He(e).Me();return this.qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Be(e){this.He(e).Be()}He(e){let t=this.Qe.get(e);return t||(t=new oZ,this.Qe.set(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new au(sZ),this.$e=this.$e.insert(e,t)),t}Je(e){let t=null!==this.Xe(e);return t||sP("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){let t=this.Qe.get(e);return t&&t.ve?null:this.qe.ut(e)}Ye(e){this.Qe.set(e,new oZ),this.qe.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ot(e,t){return this.qe.getRemoteKeysForTarget(e).has(t)}}function o1(){return new ao(s3.comparator)}function o2(){return new ao(s3.comparator)}const o9={asc:"ASCENDING",desc:"DESCENDING"},o4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},o6={and:"AND",or:"OR"};class o5{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function o3(e,t){return e.useProto3Json||null==t?t:{value:t}}function o7(e){return e||sB(),s2.fromTimestamp(function(e){let t=am(e);return new s1(t.seconds,t.nanos)}(e))}function o8(e){let t=s4.fromString(e);return la(t)||sB(),t}function le(e,t){let n=o8(t);if(n.get(1)!==e.databaseId.projectId)throw new s$(sj.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new s$(sj.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new s3(li(n))}function lt(e,t){var n;return n=e.databaseId,new s4(["projects",n.projectId,"databases",n.database]).child("documents").child(t).canonicalString()}function ln(e){return new s4(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function li(e){return e.length>4&&"documents"===e.get(4)||sB(),e.popFirst(5)}function lr(e){return{fieldPath:e.canonicalString()}}function ls(e){return s5.fromServerFormat(e.fieldPath)}function la(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class lo{constructor(e,t,n,i,r=s2.min(),s=s2.min(),a=ap.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new lo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new lo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new lo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new lo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ll{constructor(e){this.ct=e}}class lh{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ay(e.integerValue));else if("doubleValue"in e){let n=ay(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),ar(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(av(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?aF(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):sB()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let n=e.fields||{};for(let e of(this.Et(t,55),Object.keys(n)))this.Rt(e,t),this.It(n[e],t)}wt(e,t){let n=e.values||[];for(let e of(this.Et(t,50),n))this.It(e,t)}gt(e,t){this.Et(t,37),s3.fromName(e).path.forEach(e=>{this.Et(t,60),this.St(e,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}lh.bt=new lh;class lu{constructor(){this.sn=new lc}addToCollectionParentIndex(e,t){return this.sn.add(t),at.resolve()}getCollectionParents(e,t){return at.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return at.resolve()}deleteFieldIndex(e,t){return at.resolve()}getDocumentsMatchingTarget(e,t){return at.resolve(null)}getIndexType(e,t){return at.resolve(0)}getFieldIndexes(e,t){return at.resolve([])}getNextCollectionGroupToUpdate(e){return at.resolve(null)}getMinOffset(e,t){return at.resolve(s7.min())}getMinOffsetFromCollectionGroup(e,t){return at.resolve(s7.min())}updateCollectionGroup(e,t,n){return at.resolve()}updateIndexEntries(e,t){return at.resolve()}}class lc{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new au(s4.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new au(s4.comparator)).toArray()}}new Uint8Array(0);class ld{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ld(e,ld.DEFAULT_COLLECTION_PERCENTILE,ld.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ld.DEFAULT_COLLECTION_PERCENTILE=10,ld.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ld.DEFAULT=new ld(41943040,ld.DEFAULT_COLLECTION_PERCENTILE,ld.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ld.DISABLED=new ld(-1,0,0);class lf{constructor(e){this.Mn=e}next(){return this.Mn+=2,this.Mn}static xn(){return new lf(0)}static On(){return new lf(-1)}}class lp{constructor(){this.changes=new ol(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,aU.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?at.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lm{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ok(n.mutation,e,ad.empty(),s1.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,op()).next(()=>t))}getLocalViewOfDocuments(e,t,n=op()){let i=od();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=oc();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=od();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,op()))}populateOverlays(e,t,n){let i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=oh,s=od(),a=od();return t.forEach((e,t)=>{let a=n.get(t.key);i.has(t.key)&&(void 0===a||a.mutation instanceof ox)?r=r.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),ok(a.mutation,t,a.mutation.getFieldMask(),s1.now())):s.set(t.key,ad.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new lg(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=od(),i=new ao((e,t)=>e-t),r=op();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let r of e)r.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||ad.empty();a=r.applyToLocalView(s,a),n.set(e,a);let o=(i.get(r.batchId)||op()).add(e);i=i.insert(r.batchId,o)})}).next(()=>{let s=[],a=i.getReverseIterator();for(;a.hasNext();){let i=a.getNext(),o=i.key,l=i.value,h=od();l.forEach(e=>{if(!r.has(e)){let i=oD(t.get(e),n.get(e));null!==i&&h.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,h))}return at.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return s3.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{let s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):at.resolve(od()),a=-1,o=r;return s.next(t=>at.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),r.get(t)?at.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,o,t,op())).next(e=>{let t;return{batchId:a,changes:(t=ou,e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t)}}))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new s3(t)).next(e=>{let t=oc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){let i=t.collectionGroup,r=oc();return this.indexManager.getCollectionParents(e,i).next(s=>at.forEach(s,s=>{var a;let o=(a=s.child(i),new a7(a,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i))).next(e=>{i.forEach((t,n)=>{let i=n.getKey();null===e.get(i)&&(e=e.insert(i,aU.newInvalidDocument(i)))});let n=oc();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&ok(s.mutation,r,ad.empty(),s1.now()),oa(t,r)&&(n=n.insert(e,r))}),n})}}class ly{constructor(e){this.serializer=e,this.ar=new Map,this.ur=new Map}getBundleMetadata(e,t){return at.resolve(this.ar.get(t))}saveBundleMetadata(e,t){return this.ar.set(t.id,{id:t.id,version:t.version,createTime:o7(t.createTime)}),at.resolve()}getNamedQuery(e,t){return at.resolve(this.ur.get(t))}saveNamedQuery(e,t){return this.ur.set(t.name,{name:t.name,query:function(e){let t=function(e){var t,n,i,r,s,a,o,l;let h,u=function(e){let t=o8(e);return 4===t.length?s4.emptyPath():li(t)}(e.parent),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){1===d||sB();let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=function(e){var t;let n=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=ls(e.unaryFilter.field);return aK.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=ls(e.unaryFilter.field);return aK.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=ls(e.unaryFilter.field);return aK.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=ls(e.unaryFilter.field);return aK.create(r,"!=",{nullValue:"NULL_VALUE"});default:return sB()}}(t):void 0!==t.fieldFilter?aK.create(ls(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return sB()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?aH.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return sB()}}(t.compositeFilter.op)):sB()}(e);return n instanceof aH&&aQ(t=n)&&aG(t)?n.getFilters():[n]}(c.where));let g=[];c.orderBy&&(g=c.orderBy.map(e=>new aq(ls(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let m=null;c.limit&&(m=null==(h="object"==typeof(t=c.limit)?t.value:t)?null:h);let y=null;c.startAt&&(y=function(e){let t=!!e.before,n=e.values||[];return new aB(n,t)}(c.startAt));let v=null;return c.endAt&&(v=function(e){let t=!e.before,n=e.values||[];return new aB(n,t)}(c.endAt)),n=u,i=f,r=g,s=p,a=m,o=y,l=v,new a7(n,i,r,s,a,"F",o,l)}({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?on(t,t.limit,"L"):t}(t.bundledQuery),readTime:o7(t.readTime)}),at.resolve()}}class lv{constructor(){this.overlays=new ao(s3.comparator),this.cr=new Map}getOverlay(e,t){return at.resolve(this.overlays.get(t))}getOverlays(e,t){let n=od();return at.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.ht(e,t,i)}),at.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.cr.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.cr.delete(n)),at.resolve()}getOverlaysForCollection(e,t,n){let i=od(),r=t.length+1,s=new s3(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return at.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new ao((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=od(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=od(),o=r.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=i)););return at.resolve(a)}ht(e,t,n){let i=this.overlays.get(n.key);if(null!==i){let e=this.cr.get(i.largestBatchId).delete(n.key);this.cr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new oV(t,n));let r=this.cr.get(t);void 0===r&&(r=op(),this.cr.set(t,r)),this.cr.set(t,r.add(n.key))}}class lw{constructor(){this.lr=new au(lb.hr),this.Pr=new au(lb.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(e,t){let n=new lb(e,t);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Er(new lb(e,t))}dr(e,t){e.forEach(e=>this.removeReference(e,t))}Ar(e){let t=new s3(new s4([])),n=new lb(t,e),i=new lb(t,e+1),r=[];return this.Pr.forEachInRange([n,i],e=>{this.Er(e),r.push(e.key)}),r}Rr(){this.lr.forEach(e=>this.Er(e))}Er(e){this.lr=this.lr.delete(e),this.Pr=this.Pr.delete(e)}Vr(e){let t=new s3(new s4([])),n=new lb(t,e),i=new lb(t,e+1),r=op();return this.Pr.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){let t=new lb(e,0),n=this.lr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class lb{constructor(e,t){this.key=e,this.mr=t}static hr(e,t){return s3.comparator(e.key,t.key)||sZ(e.mr,t.mr)}static Ir(e,t){return sZ(e.mr,t.mr)||s3.comparator(e.key,t.key)}}class lE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.gr=1,this.pr=new au(lb.hr)}checkEmpty(e){return at.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){let r=this.gr;this.gr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new oF(r,t,n,i);for(let t of(this.mutationQueue.push(s),i))this.pr=this.pr.add(new lb(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return at.resolve(s)}lookupMutationBatch(e,t){return at.resolve(this.yr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.wr(t+1),i=n<0?0:n;return at.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return at.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(e){return at.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new lb(t,0),i=new lb(t,Number.POSITIVE_INFINITY),r=[];return this.pr.forEachInRange([n,i],e=>{let t=this.yr(e.mr);r.push(t)}),at.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new au(sZ);return t.forEach(e=>{let t=new lb(e,0),i=new lb(e,Number.POSITIVE_INFINITY);this.pr.forEachInRange([t,i],e=>{n=n.add(e.mr)})}),at.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=n;s3.isDocumentKey(r)||(r=r.child(""));let s=new lb(new s3(r),0),a=new au(sZ);return this.pr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(a=a.add(e.mr)),!0)},s),at.resolve(this.Sr(a))}Sr(e){let t=[];return e.forEach(e=>{let n=this.yr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.br(t.batchId,"removed")||sB(),this.mutationQueue.shift();let n=this.pr;return at.forEach(t.mutations,i=>{let r=new lb(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.pr=n})}Cn(e){}containsKey(e,t){let n=new lb(t,0),i=this.pr.firstAfterOrEqual(n);return at.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,at.resolve()}br(e,t){return this.wr(e)}wr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}yr(e){let t=this.wr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lT{constructor(e){this.Dr=e,this.docs=new ao(s3.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Dr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return at.resolve(n?n.document.mutableCopy():aU.newInvalidDocument(t))}getEntries(e,t){let n=oh;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():aU.newInvalidDocument(e))}),at.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=oh,s=t.path,a=new s3(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=s3.comparator(e.documentKey,t.documentKey))?n:sZ(e.largestBatchId,t.largestBatchId)}(new s7(a.readTime,a.key,-1),n)||(i.has(a.key)||oa(t,a))&&(r=r.insert(a.key,a.mutableCopy()))}return at.resolve(r)}getAllFromCollectionGroup(e,t,n,i){sB()}vr(e,t){return at.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new lI(this)}getSize(e){return at.resolve(this.size)}}class lI extends lp{constructor(e){super(),this.sr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.sr.addEntry(e,i)):this.sr.removeEntry(n)}),at.waitFor(t)}getFromCache(e,t){return this.sr.getEntry(e,t)}getAllFromCache(e,t){return this.sr.getEntries(e,t)}}class l_{constructor(e){this.persistence=e,this.Cr=new ol(e=>a6(e),a5),this.lastRemoteSnapshotVersion=s2.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new lw,this.targetCount=0,this.Or=lf.xn()}forEachTarget(e,t){return this.Cr.forEach((e,n)=>t(n)),at.resolve()}getLastRemoteSnapshotVersion(e){return at.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return at.resolve(this.Fr)}allocateTargetId(e){return this.highestTargetId=this.Or.next(),at.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Fr&&(this.Fr=t),at.resolve()}Ln(e){this.Cr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Or=new lf(t),this.highestTargetId=t),e.sequenceNumber>this.Fr&&(this.Fr=e.sequenceNumber)}addTargetData(e,t){return this.Ln(t),this.targetCount+=1,at.resolve()}updateTargetData(e,t){return this.Ln(t),at.resolve()}removeTargetData(e,t){return this.Cr.delete(t.target),this.Mr.Ar(t.targetId),this.targetCount-=1,at.resolve()}removeTargets(e,t,n){let i=0,r=[];return this.Cr.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Cr.delete(s),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),at.waitFor(r).next(()=>i)}getTargetCount(e){return at.resolve(this.targetCount)}getTargetData(e,t){let n=this.Cr.get(t)||null;return at.resolve(n)}addMatchingKeys(e,t,n){return this.Mr.Tr(t,n),at.resolve()}removeMatchingKeys(e,t,n){this.Mr.dr(t,n);let i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),at.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Mr.Ar(t),at.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Mr.Vr(t);return at.resolve(n)}containsKey(e,t){return at.resolve(this.Mr.containsKey(t))}}class lC{constructor(e,t){this.Nr={},this.overlays={},this.Br=new ai(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=e(this),this.kr=new l_(this),this.indexManager=new lu,this.remoteDocumentCache=new lT(e=>this.referenceDelegate.qr(e)),this.serializer=new ll(t),this.Qr=new ly(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Nr[e.toKey()];return n||(n=new lE(t,this.referenceDelegate),this.Nr[e.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(e,t,n){sP("MemoryPersistence","Starting transaction:",e);let i=new lS(this.Br.next());return this.referenceDelegate.Kr(),n(i).next(e=>this.referenceDelegate.$r(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Ur(e,t){return at.or(Object.values(this.Nr).map(n=>()=>n.containsKey(e,t)))}}class lS extends s8{constructor(e){super(),this.currentSequenceNumber=e}}class lA{constructor(e){this.persistence=e,this.Wr=new lw,this.Gr=null}static zr(e){return new lA(e)}get jr(){if(this.Gr)return this.Gr;throw sB()}addReference(e,t,n){return this.Wr.addReference(n,t),this.jr.delete(n.toString()),at.resolve()}removeReference(e,t,n){return this.Wr.removeReference(n,t),this.jr.add(n.toString()),at.resolve()}markPotentiallyOrphaned(e,t){return this.jr.add(t.toString()),at.resolve()}removeTarget(e,t){this.Wr.Ar(t.targetId).forEach(e=>this.jr.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.jr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Kr(){this.Gr=new Set}$r(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return at.forEach(this.jr,n=>{let i=s3.fromPath(n);return this.Hr(e,i).next(e=>{e||t.removeEntry(i,s2.min())})}).next(()=>(this.Gr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hr(e,t).next(e=>{e?this.jr.delete(t.toString()):this.jr.add(t.toString())})}qr(e){return 0}Hr(e,t){return at.or([()=>at.resolve(this.Wr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ur(e,t)])}}class lD{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Li=n,this.ki=i}static qi(e,t){let n=op(),i=op();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new lD(e,t.fromCache,n,i)}}class lk{constructor(){this.Qi=!1}initialize(e,t){this.Ki=e,this.indexManager=t,this.Qi=!0}getDocumentsMatchingQuery(e,t,n,i){return this.$i(e,t).next(r=>r||this.Ui(e,t,i,n)).next(n=>n||this.Wi(e,t))}$i(e,t){if(a8(t))return at.resolve(null);let n=ot(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(n=ot(t=on(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{let r=op(...i);return this.Ki.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Gi(t,i);return this.zi(t,s,r,n.readTime)?this.$i(e,on(t,null,"F")):this.ji(e,s,t,n)}))})))}Ui(e,t,n,i){return a8(t)||i.isEqual(s2.min())?this.Wi(e,t):this.Ki.getDocuments(e,n).next(r=>{let s=this.Gi(t,r);return this.zi(t,s,n,i)?this.Wi(e,t):(sM()<=ne.DEBUG&&sP("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),os(t)),this.ji(e,s,t,function(e,t){let n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,r=s2.fromTimestamp(1e9===i?new s1(n+1,0):new s1(n,i));return new s7(r,s3.empty(),-1)}(i,0)))})}Gi(e,t){let n=new au(oo(e));return t.forEach((t,i)=>{oa(e,i)&&(n=n.add(i))}),n}zi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Wi(e,t){return sM()<=ne.DEBUG&&sP("QueryEngine","Using full collection scan to execute query:",os(t)),this.Ki.getDocumentsMatchingQuery(e,t,s7.min())}ji(e,t,n,i){return this.Ki.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class lN{constructor(e,t,n,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new ao(sZ),this.Yi=new ol(e=>a6(e),a5),this.Zi=new Map,this.Xi=e.getRemoteDocumentCache(),this.kr=e.getTargetCache(),this.Qr=e.getBundleCache(),this.es(n)}es(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lm(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}async function lL(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,e.es(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let r=[],s=[],a=op();for(let e of i)for(let t of(r.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({ts:e,removedBatchIds:r,addedBatchIds:s}))})})}function lx(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.kr.getLastRemoteSnapshotVersion(t))}async function lR(e,t,n){let i=e.Ji.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,i))}catch(e){if(!an(e))throw e;sP("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ji=e.Ji.remove(t),e.Yi.delete(i.target)}function lO(e,t,n){let i=s2.min(),r=op();return e.persistence.runTransaction("Execute query","readonly",s=>(function(e,t,n){let i=e.Yi.get(n);return void 0!==i?at.resolve(e.Ji.get(i)):e.kr.getTargetData(t,n)})(e,s,ot(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,e.kr.getMatchingKeysForTargetId(s,t.targetId).next(e=>{r=e})}).next(()=>e.Hi.getDocumentsMatchingQuery(s,t,n?i:s2.min(),n?r:op())).next(n=>{var i;let s;return i=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),s=e.Zi.get(i)||s2.min(),n.forEach((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)}),e.Zi.set(i,s),{documents:n,ss:r}}))}class lM{constructor(){this.activeTargetIds=og}hs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ps(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ls(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class lP{constructor(){this.Hs=new lM,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hs.hs(e),this.Js[e]||"not-current"}updateQueryState(e,t,n){this.Js[e]=t}removeLocalQueryTarget(e){this.Hs.Ps(e)}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){delete this.Js[e]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(e){return this.Hs.activeTargetIds.has(e)}start(){return this.Hs=new lM,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lF{Ys(e){}shutdown(){}}class lV{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(e){this.ro.push(e)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){for(let e of(sP("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.ro))e(0)}no(){for(let e of(sP("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.ro))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lU=null;function lB(){return null===lU?lU=268435456+Math.round(2147483648*Math.random()):lU++,"0x"+lU.toString(16)}const lj={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class l${constructor(e){this.so=e.so,this.oo=e.oo}_o(e){this.ao=e}uo(e){this.co=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.so(e)}ho(){this.ao()}Po(e){this.co(e)}Io(e){this.lo(e)}}const lq="WebChannelConnection";class lz extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.To=t+"://"+e.host,this.Eo=`projects/${n}/databases/${i}`,this.Ao="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get Ro(){return!1}Vo(e,t,n,i,r){let s=lB(),a=this.mo(e,t);sP("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(o,i,r),this.po(e,a,o,n).then(t=>(sP("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw sV("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}yo(e,t,n,i,r,s){return this.Vo(e,t,n,i,r)}fo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+sR}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}mo(e,t){let n=lj[e];return`${this.To}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}po(e,t,n,i){let r=lB();return new Promise((s,a)=>{let o=new sD;o.setWithCredentials(!0),o.listenOnce(sI.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case sT.NO_ERROR:let t=o.getResponseJson();sP(lq,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case sT.TIMEOUT:sP(lq,`RPC '${e}' ${r} timed out`),a(new s$(sj.DEADLINE_EXCEEDED,"Request time out"));break;case sT.HTTP_ERROR:let n=o.getStatus();if(sP(lq,`RPC '${e}' ${r} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(sj).indexOf(t)>=0?t:sj.UNKNOWN}(t.status);a(new s$(e,t.message))}else a(new s$(sj.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new s$(sj.UNAVAILABLE,"Connection failed."));break;default:sB()}}finally{sP(lq,`RPC '${e}' ${r} completed.`)}});let l=JSON.stringify(i);sP(lq,`RPC '${e}' ${r} sending request:`,i),o.send(t,"POST",l,n,15)})}wo(e,t,n){let i=lB(),r=[this.To,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=sb(),a=sE(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.xmlHttpFactory=new sS({})),this.fo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let h=r.join("");sP(lq,`Creating RPC '${e}' stream ${i}: ${h}`,o);let u=s.createWebChannel(h,o),c=!1,f=!1,p=new l$({so:t=>{f?sP(lq,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(c||(sP(lq,`Opening RPC '${e}' stream ${i} transport.`),u.open(),c=!0),sP(lq,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},oo:()=>u.close()}),g=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return g(u,sA.EventType.OPEN,()=>{f||sP(lq,`RPC '${e}' stream ${i} transport opened.`)}),g(u,sA.EventType.CLOSE,()=>{f||(f=!0,sP(lq,`RPC '${e}' stream ${i} transport closed`),p.Po())}),g(u,sA.EventType.ERROR,t=>{f||(f=!0,sV(lq,`RPC '${e}' stream ${i} transport errored:`,t),p.Po(new s$(sj.UNAVAILABLE,"The operation could not be completed")))}),g(u,sA.EventType.MESSAGE,t=>{var n;if(!f){let r=t.data[0];r||sB();let s=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(s){sP(lq,`RPC '${e}' stream ${i} received error:`,s);let t=s.status,n=function(e){let t=d[e];if(void 0!==t)return oB(t)}(t),r=s.message;void 0===n&&(n=sj.INTERNAL,r="Unknown error status: "+t+" with message "+s.message),f=!0,p.Po(new s$(n,r)),u.close()}else sP(lq,`RPC '${e}' stream ${i} received:`,r),p.Io(r)}}),g(a,s_.STAT_EVENT,t=>{t.stat===sC.PROXY?sP(lq,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===sC.NOPROXY&&sP(lq,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{p.ho()},0),p}}function lK(){return"undefined"!=typeof document?document:null}class lH{constructor(e,t,n=1e3,i=1.5,r=6e4){this.ii=e,this.timerId=t,this.So=n,this.bo=i,this.Do=r,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(e){this.cancel();let t=Math.floor(this.vo+this.Oo()),n=Math.max(0,Date.now()-this.Fo),i=Math.max(0,t-n);i>0&&sP("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.vo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Fo=Date.now(),e())),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){null!==this.Co&&(this.Co.skipDelay(),this.Co=null)}cancel(){null!==this.Co&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}class lG{constructor(e,t,n,i,r,s,a,o){this.ii=e,this.Bo=n,this.Lo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new lH(e,t)}$o(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Wo()}async stop(){this.$o()&&await this.close(0)}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&null===this.qo&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,()=>this.jo()))}Ho(e){this.Jo(),this.stream.send(e)}async jo(){if(this.Uo())return this.close(0)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}async close(e,t){this.Jo(),this.Yo(),this.Ko.cancel(),this.ko++,4!==e?this.Ko.reset():t&&t.code===sj.RESOURCE_EXHAUSTED?(sF(t.toString()),sF("Using maximum backoff delay to prevent overloading the backend."),this.Ko.Mo()):t&&t.code===sj.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Zo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.uo(t)}Zo(){}auth(){this.state=1;let e=this.Xo(this.ko),t=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.ko===t&&this.e_(e,n)},t=>{e(()=>{let e=new s$(sj.UNKNOWN,"Fetching auth token failed: "+t.message);return this.t_(e)})})}e_(e,t){let n=this.Xo(this.ko);this.stream=this.n_(e,t),this.stream._o(()=>{n(()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,()=>(this.Uo()&&(this.state=3),Promise.resolve())),this.listener._o()))}),this.stream.uo(e=>{n(()=>this.t_(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Wo(){this.state=5,this.Ko.xo(async()=>{this.state=0,this.start()})}t_(e){return sP("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.ko===e?t():(sP("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lQ extends lG{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}n_(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.Ko.reset();let t=function(e,t){let n;if("targetChange"in t){var i,r;t.targetChange;let s="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:sB(),a=t.targetChange.targetIds||[],o=(r=t.targetChange.resumeToken,e.useProto3Json?(void 0===r||"string"==typeof r||sB(),ap.fromBase64String(r||"")):(void 0===r||r instanceof Uint8Array||sB(),ap.fromUint8Array(r||new Uint8Array))),l=t.targetChange.cause,h=l&&function(e){let t=void 0===e.code?sj.UNKNOWN:oB(e.code);return new s$(t,e.message||"")}(l);n=new oY(s,a,o,h||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=le(e,i.document.name),s=o7(i.document.updateTime),a=i.document.createTime?o7(i.document.createTime):s2.min(),o=new aV({mapValue:{fields:i.document.fields}}),l=aU.newFoundDocument(r,s,a,o),h=i.targetIds||[],u=i.removedTargetIds||[];n=new oX(h,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=le(e,i.document),s=i.readTime?o7(i.readTime):s2.min(),a=aU.newNoDocument(r,s),o=i.removedTargetIds||[];n=new oX([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=le(e,i.document),s=i.removedTargetIds||[];n=new oX([],s,r,null)}else{if(!("filter"in t))return sB();{t.filter;let e=t.filter;e.targetId;let{count:i=0,unchangedNames:r}=e,s=new oU(i,r),a=e.targetId;n=new oJ(a,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return s2.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?s2.min():t.readTime?o7(t.readTime):s2.min()}(e);return this.listener.r_(t,n)}i_(e){let t={};t.database=ln(this.serializer),t.addTarget=function(e,t){var n,i;let r;let s=t.target;if((r=a3(s)?{documents:{documents:[lt(e,s.path)]}}:{query:function(e,t){var n,i;let r={structuredQuery:{}},s=t.path;null!==t.collectionGroup?(r.parent=lt(e,s),r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r.parent=lt(e,s.popLast()),r.structuredQuery.from=[{collectionId:s.lastSegment()}]);let a=function(e){if(0!==e.length)return function e(t){return t instanceof aK?function(e){if("=="===e.op){if(aO(e.value))return{unaryFilter:{field:lr(e.field),op:"IS_NAN"}};if(aR(e.value))return{unaryFilter:{field:lr(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(aO(e.value))return{unaryFilter:{field:lr(e.field),op:"IS_NOT_NAN"}};if(aR(e.value))return{unaryFilter:{field:lr(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:lr(e.field),op:o4[e.op],value:e.value}}}(t):t instanceof aH?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:o6[t.op],filters:n}}}(t):sB()}(aH.create(e,"and"))}(t.filters);a&&(r.structuredQuery.where=a);let o=function(e){if(0!==e.length)return e.map(e=>({field:lr(e.field),direction:o9[e.dir]}))}(t.orderBy);o&&(r.structuredQuery.orderBy=o);let l=o3(e,t.limit);return null!==l&&(r.structuredQuery.limit=l),t.startAt&&(r.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(r.structuredQuery.endAt={before:!(i=t.endAt).inclusive,values:i.position}),r}(e,s)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=(n=t.resumeToken,e.useProto3Json?n.toBase64():n.toUint8Array());let i=o3(e,t.expectedCount);null!==i&&(r.expectedCount=i)}else if(t.snapshotVersion.compareTo(s2.min())>0){r.readTime=(i=t.snapshotVersion.toTimestamp(),e.useProto3Json?`${new Date(1e3*i.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+i.nanoseconds).slice(-9)}Z`:{seconds:""+i.seconds,nanos:i.nanoseconds});let n=o3(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return sB()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Ho(t)}s_(e){let t={};t.database=ln(this.serializer),t.removeTarget=e,this.Ho(t)}}class lW extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.h_=!1}P_(){if(this.h_)throw new s$(sj.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(e,t,n){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,r])=>this.connection.Vo(e,t,n,i,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===sj.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new s$(sj.UNKNOWN,e.toString())})}yo(e,t,n,i){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.yo(e,t,n,r,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===sj.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new s$(sj.UNKNOWN,e.toString())})}terminate(){this.h_=!0}}class lX{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){0===this.T_&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve())))}m_(e){"Online"===this.state?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.R_("Offline")))}set(e){this.f_(),this.T_=0,"Online"===e&&(this.d_=!1),this.R_(e)}R_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}V_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(sF(t),this.d_=!1):sP("OnlineStateTracker",t)}f_(){null!==this.E_&&(this.E_.cancel(),this.E_=null)}}class lJ{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=r,this.S_.Ys(e=>{n.enqueueAndForget(async()=>{l5(this)&&(sP("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.y_.add(4),await lZ(e),e.b_.set("Unknown"),e.y_.delete(4),await lY(e)}(this))})}),this.b_=new lX(n,i)}}async function lY(e){if(l5(e))for(let t of e.w_)await t(!0)}async function lZ(e){for(let t of e.w_)await t(!1)}function l0(e,t){e.p_.has(t.targetId)||(e.p_.set(t.targetId,t),l6(e)?l4(e):hi(e).Uo()&&l2(e,t))}function l1(e,t){let n=hi(e);e.p_.delete(t),n.Uo()&&l9(e,t),0===e.p_.size&&(n.Uo()?n.zo():l5(e)&&e.b_.set("Unknown"))}function l2(e,t){if(e.D_.Be(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(s2.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}hi(e).i_(t)}function l9(e,t){e.D_.Be(t),hi(e).s_(t)}function l4(e){e.D_=new o0({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>e.p_.get(t)||null,rt:()=>e.datastore.serializer.databaseId}),hi(e).start(),e.b_.A_()}function l6(e){return l5(e)&&!hi(e).$o()&&e.p_.size>0}function l5(e){return 0===e.y_.size}async function l3(e){e.p_.forEach((t,n)=>{l2(e,t)})}async function l7(e,t){e.D_=void 0,l6(e)?(e.b_.m_(t),l4(e)):e.b_.set("Unknown")}async function l8(e,t,n){if(e.b_.set("Online"),t instanceof oY&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let i of t.targetIds)e.p_.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.p_.delete(i),e.D_.removeTarget(i))}(e,t)}catch(n){sP("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await he(e,n)}else if(t instanceof oX?e.D_.We(t):t instanceof oJ?e.D_.Ze(t):e.D_.je(t),!n.isEqual(s2.min()))try{let t=await lx(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.D_.st(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){let r=e.p_.get(i);r&&e.p_.set(i,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let i=e.p_.get(t);if(!i)return;e.p_.set(t,i.withResumeToken(ap.EMPTY_BYTE_STRING,i.snapshotVersion)),l9(e,t);let r=new lo(i.target,t,n,i.sequenceNumber);l2(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){sP("RemoteStore","Failed to raise snapshot:",t),await he(e,t)}}async function he(e,t,n){if(!an(t))throw t;e.y_.add(1),await lZ(e),e.b_.set("Offline"),n||(n=()=>lx(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{sP("RemoteStore","Retrying IndexedDB access"),await n(),e.y_.delete(1),await lY(e)})}async function ht(e,t){e.asyncQueue.verifyOperationInProgress(),sP("RemoteStore","RemoteStore received new credentials");let n=l5(e);e.y_.add(3),await lZ(e),n&&e.b_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.y_.delete(3),await lY(e)}async function hn(e,t){t?(e.y_.delete(2),await lY(e)):t||(e.y_.add(2),await lZ(e),e.b_.set("Unknown"))}function hi(e){var t,n,i;return e.v_||(e.v_=(t=e.datastore,n=e.asyncQueue,i={_o:l3.bind(null,e),uo:l7.bind(null,e),r_:l8.bind(null,e)},t.P_(),new lQ(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i)),e.w_.push(async t=>{t?(e.v_.Go(),l6(e)?l4(e):e.b_.set("Unknown")):(await e.v_.stop(),e.D_=void 0)})),e.v_}class hr{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new sq,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,i,r){let s=Date.now()+n,a=new hr(e,t,s,i,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new s$(sj.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hs(e,t){if(sF("AsyncQueue",`${t}: ${e}`),an(e))return new s$(sj.UNAVAILABLE,`${t}: ${e}`);throw e}class ha{constructor(e){this.comparator=e?(t,n)=>e(t,n)||s3.comparator(t.key,n.key):(e,t)=>s3.comparator(e.key,t.key),this.keyedMap=oc(),this.sortedSet=new ao(this.comparator)}static emptySet(e){return new ha(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ha)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new ha;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ho{constructor(){this.F_=new ao(s3.comparator)}track(e){let t=e.doc.key,n=this.F_.get(t);n?0!==e.type&&3===n.type?this.F_=this.F_.insert(t,e):3===e.type&&1!==n.type?this.F_=this.F_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.F_=this.F_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.F_=this.F_.remove(t):1===e.type&&2===n.type?this.F_=this.F_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):sB():this.F_=this.F_.insert(t,e)}M_(){let e=[];return this.F_.inorderTraversal((t,n)=>{e.push(n)}),e}}class hl{constructor(e,t,n,i,r,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new hl(e,t,ha.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class hh{constructor(){this.x_=void 0,this.listeners=[]}}class hu{constructor(){this.queries=new ol(e=>or(e),oi),this.onlineState="Unknown",this.O_=new Set}}async function hc(e,t){let n=t.query,i=!1,r=e.queries.get(n);if(r||(i=!0,r=new hh),i)try{r.x_=await e.onListen(n)}catch(n){let e=hs(n,`Initialization of query '${os(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,r),r.listeners.push(t),t.N_(e.onlineState),r.x_&&t.B_(r.x_)&&hg(e)}async function hd(e,t){let n=t.query,i=!1,r=e.queries.get(n);if(r){let e=r.listeners.indexOf(t);e>=0&&(r.listeners.splice(e,1),i=0===r.listeners.length)}if(i)return e.queries.delete(n),e.onUnlisten(n)}function hf(e,t){let n=!1;for(let i of t){let t=i.query,r=e.queries.get(t);if(r){for(let e of r.listeners)e.B_(i)&&(n=!0);r.x_=i}}n&&hg(e)}function hp(e,t,n){let i=e.queries.get(t);if(i)for(let e of i.listeners)e.onError(n);e.queries.delete(t)}function hg(e){e.O_.forEach(e=>{e.next()})}class hm{constructor(e,t,n){this.query=e,this.L_=t,this.k_=!1,this.q_=null,this.onlineState="Unknown",this.options=n||{}}B_(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new hl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.k_?this.Q_(e)&&(this.L_.next(e),t=!0):this.K_(e,this.onlineState)&&(this.U_(e),t=!0),this.q_=e,t}onError(e){this.L_.error(e)}N_(e){this.onlineState=e;let t=!1;return this.q_&&!this.k_&&this.K_(this.q_,e)&&(this.U_(this.q_),t=!0),t}K_(e,t){return!e.fromCache||(!this.options.W_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Q_(e){if(e.docChanges.length>0)return!0;let t=this.q_&&this.q_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}U_(e){e=hl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.k_=!0,this.L_.next(e)}}class hy{constructor(e){this.key=e}}class hv{constructor(e){this.key=e}}class hw{constructor(e,t){this.query=e,this.X_=t,this.ea=null,this.hasCachedResults=!1,this.current=!1,this.ta=op(),this.mutatedKeys=op(),this.na=oo(e),this.ra=new ha(this.na)}get ia(){return this.X_}sa(e,t){let n=t?t.oa:new ho,i=t?t.ra:this.ra,r=t?t.mutatedKeys:this.mutatedKeys,s=i,a=!1,o="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{let h=i.get(e),u=oa(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this._a(h,u)||(n.track({type:2,doc:u}),f=!0,(o&&this.na(u,o)>0||l&&0>this.na(u,l))&&(a=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(o||l)&&(a=!0)),f&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{ra:s,oa:n,zi:a,mutatedKeys:r}}_a(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let i=this.ra;this.ra=e.ra,this.mutatedKeys=e.mutatedKeys;let r=e.oa.M_();r.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return sB()}};return n(e)-n(t)})(e.type,t.type)||this.na(e.doc,t.doc)),this.aa(n);let s=t?this.ua():[],a=0===this.ta.size&&this.current?1:0,o=a!==this.ea;return(this.ea=a,0!==r.length||o)?{snapshot:new hl(this.query,e.ra,i,r,e.mutatedKeys,0===a,o,!1,!!n&&n.resumeToken.approximateByteSize()>0),ca:s}:{ca:s}}N_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ra:this.ra,oa:new ho,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ca:[]}}la(e){return!this.X_.has(e)&&!!this.ra.has(e)&&!this.ra.get(e).hasLocalMutations}aa(e){e&&(e.addedDocuments.forEach(e=>this.X_=this.X_.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.X_=this.X_.delete(e)),this.current=e.current)}ua(){if(!this.current)return[];let e=this.ta;this.ta=op(),this.ra.forEach(e=>{this.la(e.key)&&(this.ta=this.ta.add(e.key))});let t=[];return e.forEach(e=>{this.ta.has(e)||t.push(new hv(e))}),this.ta.forEach(n=>{e.has(n)||t.push(new hy(n))}),t}ha(e){this.X_=e.ss,this.ta=op();let t=this.sa(e.documents);return this.applyChanges(t,!0)}Pa(){return hl.fromInitialDocuments(this.query,this.ra,this.mutatedKeys,0===this.ea,this.hasCachedResults)}}class hb{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class hE{constructor(e){this.key=e,this.Ia=!1}}class hT{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Ta={},this.Ea=new ol(e=>or(e),oi),this.da=new Map,this.Aa=new Set,this.Ra=new ao(s3.comparator),this.Va=new Map,this.ma=new lw,this.fa={},this.ga=new Map,this.pa=lf.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return!0===this.ya}}async function hI(e,t){var n,i;let r,s;let a=(e.remoteStore.remoteSyncer.applyRemoteEvent=hS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hD.bind(null,e),e.Ta.r_=hf.bind(null,e.eventManager),e.Ta.Sa=hp.bind(null,e.eventManager),e),o=a.Ea.get(t);if(o)r=o.targetId,a.sharedClientState.addLocalQueryTarget(r),s=o.view.Pa();else{let e=await (n=a.localStore,i=ot(t),n.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return n.kr.getTargetData(e,i).next(r=>r?(t=r,at.resolve(t)):n.kr.allocateTargetId(e).next(r=>(t=new lo(i,r,"TargetPurposeListen",e.currentSequenceNumber),n.kr.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=n.Ji.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(i,e.targetId)),e})),o=a.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await h_(a,t,r,"current"===o,e.resumeToken),a.isPrimaryClient&&l0(a.remoteStore,e)}return s}async function h_(e,t,n,i,r){e.wa=(t,n,i)=>(async function(e,t,n,i){let r=t.view.sa(n);r.zi&&(r=await lO(e.localStore,t.query,!1).then(({documents:e})=>t.view.sa(e,r)));let s=i&&i.targetChanges.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s);return hL(e,t.targetId,a.ca),a.snapshot})(e,t,n,i);let s=await lO(e.localStore,t,!0),a=new hw(t,s.ss),o=a.sa(s.documents),l=oW.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),h=a.applyChanges(o,e.isPrimaryClient,l);hL(e,n,h.ca);let u=new hb(t,n,a);return e.Ea.set(t,u),e.da.has(n)?e.da.get(n).push(t):e.da.set(n,[t]),h.snapshot}async function hC(e,t){let n=e.Ea.get(t),i=e.da.get(n.targetId);if(i.length>1)return e.da.set(n.targetId,i.filter(e=>!oi(e,t))),void e.Ea.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await lR(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),l1(e.remoteStore,n.targetId),hk(e,n.targetId)}).catch(ae)):(hk(e,n.targetId),await lR(e.localStore,n.targetId,!0))}async function hS(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,i=e.Ji;return e.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{var s;let a,o;let l=e.Xi.newChangeBuffer({trackRemovals:!0});i=e.Ji;let h=[];t.targetChanges.forEach((s,a)=>{var o;let l=i.get(a);if(!l)return;h.push(e.kr.removeMatchingKeys(r,s.removedDocuments,a).next(()=>e.kr.addMatchingKeys(r,s.addedDocuments,a)));let u=l.withSequenceNumber(r.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(ap.EMPTY_BYTE_STRING,s2.min()).withLastLimboFreeSnapshotVersion(s2.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(a,u),o=u,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&h.push(e.kr.updateTargetData(r,u))});let u=oh,c=op();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&h.push(e.persistence.referenceDelegate.updateLimboDocument(r,n))}),h.push((s=t.documentUpdates,a=op(),o=op(),s.forEach(e=>a=a.add(e)),l.getEntries(r,a).next(e=>{let t=oh;return s.forEach((n,i)=>{let r=e.get(n);i.isFoundDocument()!==r.isFoundDocument()&&(o=o.add(n)),i.isNoDocument()&&i.version.isEqual(s2.min())?(l.removeEntry(n,i.readTime),t=t.insert(n,i)):!r.isValidDocument()||i.version.compareTo(r.version)>0||0===i.version.compareTo(r.version)&&r.hasPendingWrites?(l.addEntry(i),t=t.insert(n,i)):sP("LocalStore","Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)}),{ns:t,rs:o}})).next(e=>{u=e.ns,c=e.rs})),!n.isEqual(s2.min())){let t=e.kr.getLastRemoteSnapshotVersion(r).next(t=>e.kr.setTargetsMetadata(r,r.currentSequenceNumber,n));h.push(t)}return at.waitFor(h).next(()=>l.apply(r)).next(()=>e.localDocuments.getLocalViewOfDocuments(r,u,c)).next(()=>u)}).then(t=>(e.Ji=i,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let i=e.Va.get(n);i&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||sB(),t.addedDocuments.size>0?i.Ia=!0:t.modifiedDocuments.size>0?i.Ia||sB():t.removedDocuments.size>0&&(i.Ia||sB(),i.Ia=!1))}),await hR(e,n,t)}catch(e){await ae(e)}}function hA(e,t,n){var i;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n;let r=[];e.Ea.forEach((e,n)=>{let i=n.view.N_(t);i.snapshot&&r.push(i.snapshot)}),(i=e.eventManager).onlineState=t,n=!1,i.queries.forEach((e,i)=>{for(let e of i.listeners)e.N_(t)&&(n=!0)}),n&&hg(i),r.length&&e.Ta.r_(r),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function hD(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let i=e.Va.get(t),r=i&&i.key;if(r){let n=new ao(s3.comparator);n=n.insert(r,aU.newNoDocument(r,s2.min()));let i=op().add(r),s=new oQ(s2.min(),new Map,new ao(sZ),n,i);await hS(e,s),e.Ra=e.Ra.remove(r),e.Va.delete(t),hx(e)}else await lR(e.localStore,t,!1).then(()=>hk(e,t,n)).catch(ae)}function hk(e,t,n=null){for(let i of(e.sharedClientState.removeLocalQueryTarget(t),e.da.get(t)))e.Ea.delete(i),n&&e.Ta.Sa(i,n);e.da.delete(t),e.isPrimaryClient&&e.ma.Ar(t).forEach(t=>{e.ma.containsKey(t)||hN(e,t)})}function hN(e,t){e.Aa.delete(t.path.canonicalString());let n=e.Ra.get(t);null!==n&&(l1(e.remoteStore,n),e.Ra=e.Ra.remove(t),e.Va.delete(n),hx(e))}function hL(e,t,n){for(let i of n)i instanceof hy?(e.ma.addReference(i.key,t),function(e,t){let n=t.key,i=n.path.canonicalString();e.Ra.get(n)||e.Aa.has(i)||(sP("SyncEngine","New document in limbo: "+n),e.Aa.add(i),hx(e))}(e,i)):i instanceof hv?(sP("SyncEngine","Document no longer in limbo: "+i.key),e.ma.removeReference(i.key,t),e.ma.containsKey(i.key)||hN(e,i.key)):sB()}function hx(e){for(;e.Aa.size>0&&e.Ra.size<e.maxConcurrentLimboResolutions;){var t;let n=e.Aa.values().next().value;e.Aa.delete(n);let i=new s3(s4.fromString(n)),r=e.pa.next();e.Va.set(r,new hE(i)),e.Ra=e.Ra.insert(i,r),l0(e.remoteStore,new lo(ot((t=i.path,new a7(t))),r,"TargetPurposeLimboResolution",ai.ae))}}async function hR(e,t,n){let i=[],r=[],s=[];e.Ea.isEmpty()||(e.Ea.forEach((a,o)=>{s.push(e.wa(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(o.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);let e=lD.qi(o.targetId,t);r.push(e)}}))}),await Promise.all(s),e.Ta.r_(i),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>at.forEach(t,t=>at.forEach(t.Li,i=>e.persistence.referenceDelegate.addReference(n,t.targetId,i)).next(()=>at.forEach(t.ki,i=>e.persistence.referenceDelegate.removeReference(n,t.targetId,i)))))}catch(e){if(!an(e))throw e;sP("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ji.get(t),i=n.snapshotVersion,r=n.withLastLimboFreeSnapshotVersion(i);e.Ji=e.Ji.insert(t,r)}}}(e.localStore,r))}async function hO(e,t){if(!e.currentUser.isEqual(t)){sP("SyncEngine","User change. New user:",t.toKey());let n=await lL(e.localStore,t);e.currentUser=t,e.ga.forEach(e=>{e.forEach(e=>{e.reject(new s$(sj.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.ga.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await hR(e,n.ts)}}function hM(e,t){let n=e.Va.get(t);if(n&&n.Ia)return op().add(n.key);{let n=op(),i=e.da.get(t);if(!i)return n;for(let t of i){let i=e.Ea.get(t);n=n.unionWith(i.view.ia)}return n}}class hP{constructor(){this.synchronizeTabs=!1}async initialize(e){var t;this.serializer=(t=e.databaseInfo.databaseId,new o5(t,!0)),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t,n,i,r;return t=this.persistence,n=new lk,i=e.initialUser,r=this.serializer,new lN(t,n,i,r)}createPersistence(e){return new lC(lA.zr,this.serializer)}createSharedClientState(e){return new lP}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class hF{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>hA(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=hO.bind(null,this.syncEngine),await hn(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hu}createDatastore(e){var t,n,i,r;let s=(t=e.databaseInfo.databaseId,new o5(t,!0)),a=(n=e.databaseInfo,new lz(n));return i=e.authCredentials,r=e.appCheckCredentials,new lW(i,r,a,s)}createRemoteStore(e){var t,n,i,r;return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=lV.v()?new lV:new lF,new lJ(t,n,i,e=>hA(this.syncEngine,e,0),r)}createSyncEngine(e,t){return function(e,t,n,i,r,s,a){let o=new hT(e,t,n,i,r,s);return a&&(o.ya=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){sP("RemoteStore","RemoteStore shutting down."),e.y_.add(5),await lZ(e),e.S_.shutdown(),e.b_.set("Unknown")}(this.remoteStore)}}class hV{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.va(this.observer.next,e)}error(e){this.observer.error?this.va(this.observer.error,e):sF("Uncaught Error in snapshot listener:",e.toString())}Ca(){this.muted=!0}va(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class hU{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=sx.UNAUTHENTICATED,this.clientId=sY.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{sP("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(sP("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new s$(sj.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new sq;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=hs(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function hB(e,t){e.asyncQueue.verifyOperationInProgress(),sP("FirestoreClient","Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await lL(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function hj(e,t){e.asyncQueue.verifyOperationInProgress();let n=await h$(e);sP("FirestoreClient","Initializing OnlineComponentProvider");let i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener(e=>ht(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ht(t.remoteStore,n)),e._onlineComponents=t}async function h$(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){sP("FirestoreClient","Using user provided OfflineComponentProvider");try{await hB(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===sj.FAILED_PRECONDITION||t.code===sj.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;sV("Error using user provided cache. Falling back to memory cache: "+t),await hB(e,new hP)}}else sP("FirestoreClient","Using default OfflineComponentProvider"),await hB(e,new hP)}return e._offlineComponents}async function hq(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(sP("FirestoreClient","Using user provided OnlineComponentProvider"),await hj(e,e._uninitializedComponentsProvider._online)):(sP("FirestoreClient","Using default OnlineComponentProvider"),await hj(e,new hF))),e._onlineComponents}async function hz(e){let t=await hq(e),n=t.eventManager;return n.onListen=hI.bind(null,t.syncEngine),n.onUnlisten=hC.bind(null,t.syncEngine),n}function hK(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const hH=new Map;function hG(e){if(!s3.isDocumentKey(e))throw new s$(sj.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function hQ(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new s$(sj.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=function(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":sB()}(e);throw new s$(sj.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class hW{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new s$(sj.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new s$(sj.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new s$(sj.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hK(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new s$(sj.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new s$(sj.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new s$(sj.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hX{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hW({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new s$(sj.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new s$(sj.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hW(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new sK;switch(e.type){case"firstParty":return new sW(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new s$(sj.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=hH.get(e);t&&(sP("ComponentProvider","Removing Datastore"),hH.delete(e),t.terminate())}(this),Promise.resolve()}}class hJ{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hJ(this.firestore,e,this._query)}}class hY{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hZ(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hY(this.firestore,e,this._key)}}class hZ extends hJ{constructor(e,t,n){super(e,t,new a7(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new hY(this.firestore,null,new s3(e))}withConverter(e){return new hZ(this.firestore,e,this._path)}}function h0(e,t,...n){if(e=X(e),1==arguments.length&&(t=sY.V()),function(e,t,n){if(!n)throw new s$(sj.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof hX){let i=s4.fromString(t,...n);return hG(i),new hY(e,null,new s3(i))}{if(!(e instanceof hY||e instanceof hZ))throw new s$(sj.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(s4.fromString(t,...n));return hG(i),new hY(e.firestore,e instanceof hZ?e.converter:null,new s3(i))}}class h1{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new lH(this,"async_queue_retry"),this.Xa=()=>{let e=lK();e&&sP("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Ko.No()};let e=lK();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.eu(),this.tu(e)}enterRestrictedMode(e){if(!this.za){this.za=!0,this.Ya=e||!1;let t=lK();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xa)}}enqueue(e){if(this.eu(),this.za)return new Promise(()=>{});let t=new sq;return this.tu(()=>this.za&&this.Ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ga.push(e),this.nu()))}async nu(){if(0!==this.Ga.length){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(e){if(!an(e))throw e;sP("AsyncQueue","Operation failed with retryable error: "+e)}this.Ga.length>0&&this.Ko.xo(()=>this.nu())}}tu(e){let t=this.Wa.then(()=>(this.Ja=!0,e().catch(e=>{let t;this.Ha=e,this.Ja=!1;let n=(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t);throw sF("INTERNAL UNHANDLED ERROR: ",n),e}).then(e=>(this.Ja=!1,e))));return this.Wa=t,t}enqueueAfterDelay(e,t,n){this.eu(),this.Za.indexOf(e)>-1&&(t=0);let i=hr.createAndSchedule(this,e,t,n,e=>this.ru(e));return this.ja.push(i),i}eu(){this.Ha&&sB()}verifyOperationInProgress(){}async iu(){let e;do e=this.Wa,await e;while(e!==this.Wa)}su(e){for(let t of this.ja)if(t.timerId===e)return!0;return!1}ou(e){return this.iu().then(()=>{for(let t of(this.ja.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.ja))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.iu()})}_u(e){this.Za.push(e)}ru(e){let t=this.ja.indexOf(e);this.ja.splice(t,1)}}class h2 extends hX{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new h1,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||h9(this),this._firestoreClient.terminate()}}function h9(e){var t,n,i,r,s,a;let o=e._freezeSettings(),l=(r=e._databaseId,s=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",a=e._persistenceKey,new aT(r,s,a,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,hK(o.experimentalLongPollingOptions),o.useFetchStreams));e._firestoreClient=new hU(e._authCredentials,e._appCheckCredentials,e._queue,l),(null===(n=o.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=o.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:o.localCache.kind,_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider})}class h4{constructor(e){this._byteString=e}static fromBase64String(e){try{return new h4(ap.fromBase64String(e))}catch(e){throw new s$(sj.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new h4(ap.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class h6{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new s$(sj.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new s5(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class h5{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new s$(sj.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new s$(sj.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return sZ(this._lat,e._lat)||sZ(this._long,e._long)}}const h3=RegExp("[~\\*/\\[\\]]");function h7(e,t,n,i,r){let s=i&&!i.isEmpty(),a=void 0!==r,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${i}`),a&&(l+=` in document ${r}`),l+=")"),new s$(sj.INVALID_ARGUMENT,o+e+l)}class h8{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new hY(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new ue(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ut("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ue extends h8{data(){return super.data()}}function ut(e,t){return"string"==typeof t?function(e,t,n){if(t.search(h3)>=0)throw h7(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new h6(...t.split("."))._internalPath}catch(i){throw h7(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}(e,t):t instanceof h6?t._internalPath:t._delegate._internalPath}class un{convertValue(e,t="none"){switch(aC(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ay(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(av(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw sB()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return aa(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertGeoPoint(e){return new h5(ay(e.latitude),ay(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ab(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(aE(e));default:return null}}convertTimestamp(e){let t=am(e);return new s1(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=s4.fromString(e);la(n)||sB();let i=new aI(n.get(1),n.get(3)),r=new s3(n.popFirst(5));return i.isEqual(t)||sF(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class ui{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ur extends h8{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new us(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(ut("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class us extends ur{data(e={}){return super.data(e)}}function ua(e){e=hQ(e,hY);let t=hQ(e.firestore,h2);return(function(e,t,n={}){let i=new sq;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,i,r){var s;let a=new hV({next:s=>{t.enqueueAndForget(()=>hd(e,o));let a=s.docs.has(n);!a&&s.fromCache?r.reject(new s$(sj.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&i&&"server"===i.source?r.reject(new s$(sj.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(s)},error:e=>r.reject(e)}),o=new hm((s=n.path,new a7(s)),a,{includeMetadataChanges:!0,W_:!0});return hc(e,o)})(await hz(e),e.asyncQueue,t,n,i)),i.promise})((t._firestoreClient||h9(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient),e._key).then(n=>(function(e,t,n){let i=n.docs.get(t._key),r=new uo(e);return new ur(e,r,t._key,i,new ui(n.hasPendingWrites,n.fromCache),t.converter)})(t,e,n))}class uo extends un{constructor(e){super(),this.firestore=e}convertBytes(e){return new h4(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hY(this.firestore,null,t)}}!function(e,t=!0){sR="10.1.0",eD(new J("firestore",(e,{instanceIdentifier:n,options:i})=>{let r=e.getProvider("app").getImmediate(),s=new h2(new sG(e.getProvider("auth-internal")),new sJ(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new s$(sj.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new aI(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),eO(sL,"4.1.0",void 0),eO(sL,"4.1.0","esm2017")}();const ul=document.getElementById("leds"),uh=ex({apiKey:"AIzaSyBvF6pmf9rnqdxxjs88JOli41-oJJLSbl4",authDomain:"mofilabs-next-demo-02.firebaseapp.com",projectId:"mofilabs-next-demo-02",storageBucket:"mofilabs-next-demo-02.appspot.com",messagingSenderId:"690199829387",appId:"1:690199829387:web:bb56b5bfc40a40f42e6d8e",measurementId:"G-01E8M2RQYJ"});!function(e=eR()){e=X(e);let t=ek(e,tM);t.isInitialized()?t.getImmediate():function(e,t={}){let n=ek(e,tM);if(n.isInitialized()){let e=n.getImmediate();if(G(t,n.getOptions()))return e;throw tV.create("already-initialized")}let i=n.initialize({options:t});return i}(e)}(uh);const uu=function(e,t){let n="object"==typeof e?e:eR(),i=ek(n,"firestore").getImmediate({identifier:"string"==typeof e?e:"(default)"});if(!i._initialized){let e=U("firestore");e&&function(e,t,n,i={}){var r;let s=(e=hQ(e,hX))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&sV("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=sx.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[x(JSON.stringify({alg:"none",type:"JWT"})),x(JSON.stringify(s)),""].join(".")}(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);let s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new s$(sj.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new sx(s)}e._authCredentials=new sH(new sz(t,n))}}(i,...e)}return i}(uh);async function uc(e){let t=h0(e,"mapping","data"),n=await ua(t);if(n.exists()){let{data:e}=n.data();return console.log(e),e}return console.log("no such document"),null}async function ud(e){let t=h0(e,"gke","data"),n=await ua(t);if(n.exists()){let{data:e}=n.data();console.log(e);let t=e._byteString.binaryString,i=[];for(let e=0;e<t.length;e+=3){let n=t.charCodeAt(e)<<16|t.charCodeAt(e+1)<<8|t.charCodeAt(e+2),r=function(e){if(e<0||e>16777215)throw Error("Invalid integer value for a color.");let t=e.toString(16);for(;t.length<6;)t="0"+t;return"#"+t}(n);i.push(r)}return i}return console.log("no such document"),null}!async function(){let e=await uc(uu);!function(){for(let e=0;e<64;e++){let t=document.createElement("row");t.classList.add("row");for(let n=0;n<64;n++){let i=document.createElement("div");i.setAttribute("id",`${64*e+n}`),i.classList.add("cell"),t.appendChild(i)}ul.appendChild(t)}}(),setInterval(async()=>{let t=await ud(uu);!function(e,t){for(let n=0;n<e.length;n++){let i=n.toString(10),r=document.getElementById(i);r.style.backgroundColor=`${e[t[n]]}`}}(t,e)},3e3)}();
//# sourceMappingURL=index.90c7ae52.js.map
